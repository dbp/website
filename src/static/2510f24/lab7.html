<!doctype HTML>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ["$","$"], ["\\(","\\)"] ],
    displayMath: [ ["$$","$$"], 
                   ["\\[","\\]"], 
                   ["\\begin{equation}","\\end{equation}"], 
                   ["\\begin{equation*}","\\end{equation*}"] ],
    processEscapes: true,
    ignoreClass: "tex2jax_ignore|JavaHighlightBlock|JavaHighlight"
  },
  "HTML-CSS": {
    availableFonts: [],
    webFont: "Asana-Math",
    preferredFont: "Asana-Math",
    imageFont: null,
    mtexFontInherit: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="codemirror.js"></script>
<script src="python.js"></script>
<script src="runmode.js"></script>
<script src="setup-page.js"></script>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Lab 7: Sameness</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra-styles.css" title="default"/><link rel="stylesheet" type="text/css" href="codemirror.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Fundamentals II
<br/>
Introduction to Class-<wbr></wbr>based Program Design</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="General.html" class="tocviewlink" data-pltdoc="x">General</a></td></tr><tr><td align="right"></td><td><a href="Texts.html" class="tocviewlink" data-pltdoc="x">Texts</a></td></tr><tr><td align="right"></td><td><a href="Lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a></td></tr><tr><td align="right"></td><td><a href="Syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a></td></tr><tr><td align="right"></td><td><a href="Lab_Materials.html" class="tocviewselflink" data-pltdoc="x">Lab Materials</a></td></tr><tr><td align="right"></td><td><a href="Assignments.html" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr><tr><td align="right"></td><td><a href="Pair_Programming_Overview.html" class="tocviewlink" data-pltdoc="x">Pair Programming Overview</a></td></tr><tr><td align="right"></td><td><a href="code-style.html" class="tocviewlink" data-pltdoc="x">Code style</a></td></tr><tr><td align="right"></td><td><a href="Documentation.html" class="tocviewlink" data-pltdoc="x">Documentation</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="Lab_Materials.html" class="tocviewlink" data-pltdoc="x">Lab Materials</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="lab1.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 1:</span> Introduction to Eclipse and Simple Data Definitions</a></td></tr><tr><td align="right"></td><td><a href="lab2.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 2:</span> Working with Self-<wbr></wbr>Referential Data</a></td></tr><tr><td align="right"></td><td><a href="lab3.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 3:</span> Working with the debugger</a></td></tr><tr><td align="right"></td><td><a href="lab4.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 4:</span> Working with Abstract Classes, Problem Solving</a></td></tr><tr><td align="right"></td><td><a href="lab5.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 5:</span> Higher-<wbr></wbr>order functions</a></td></tr><tr><td align="right"></td><td><a href="lab6.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 6:</span> Working with Cyclic Data</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x"><span class="LabNum">Lab 7:</span> Sameness</a></td></tr><tr><td align="right"></td><td><a href="lab8.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 8:</span> Parametric data and visitors</a></td></tr><tr><td align="right"></td><td><a href="lab9.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 9:</span> Working with Array<span class="mywbr"> &nbsp;</span>Lists and Loops</a></td></tr><tr><td align="right"></td><td><a href="lab10.html" class="tocviewlink" data-pltdoc="x"><span class="LabNum">Lab 10:</span> An Introduction to the JUnit testing library</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x"><span class="LabNum">Lab 7:</span> Sameness</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">7.1&nbsp;</td><td><a href="#%28part._.Defining_equality%29" class="tocviewlink" data-pltdoc="x">Defining equality</a></td></tr><tr><td align="right">7.2&nbsp;</td><td><a href="#%28part._.Two_approaches__bad_and_good%29" class="tocviewlink" data-pltdoc="x">Two approaches:<span class="mywbr"> &nbsp;</span> bad and good</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">7.1<tt>&nbsp;</tt></span><a href="#%28part._.Defining_equality%29" class="tocsubseclink" data-pltdoc="x">Defining equality</a></td></tr><tr><td><span class="tocsublinknumber">7.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Getting_started%29" class="tocsubseclink" data-pltdoc="x">Getting started</a></td></tr><tr><td><span class="tocsublinknumber">7.2<tt>&nbsp;</tt></span><a href="#%28part._.Two_approaches__bad_and_good%29" class="tocsubseclink" data-pltdoc="x">Two approaches:<span class="mywbr"> &nbsp;</span> bad and good</a></td></tr><tr><td><span class="tocsublinknumber">7.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Bad_.Option_-_.Incorrect_alternative_%29" class="tocsubseclink" data-pltdoc="x">Bad Option -<wbr></wbr> Incorrect alternative:</a></td></tr><tr><td><span class="tocsublinknumber">7.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Good_.Option_-_.A_.Better_alternative_%29" class="tocsubseclink" data-pltdoc="x">Good Option -<wbr></wbr> A Better alternative:</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.14</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="lab6.html" title="backward to &quot;Lab 6: Working with Cyclic Data&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Lab_Materials.html" title="up to &quot;Lab Materials&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="lab8.html" title="forward to &quot;Lab 8: Parametric data and visitors&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h4 class="heading"><a name="(part._)"></a><span class="LabNum">Lab 7:</span> Sameness<span class="button-group"><a href="#(part._)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><span style="font-weight: bold">Goals:</span> Practice designing equality methods for union data types</p><div class="RelatedFiles"><blockquote><p class="boxed">Related files:<br/><span class="hspace">&nbsp;&nbsp;</span><a href="files/labs/R-LAB-equality/files/labs/R-LAB-equality/Banking.zip">Banking.zip</a><span class="hspace">&nbsp;&nbsp;</span> </p></blockquote></div><p><span style="font-weight: bold">Submission:</span> There is no submission for this lab.</p><h5 class="heading">7.1<tt>&nbsp;</tt><a name="(part._.Defining_equality)"></a>Defining equality<span class="button-group"><a href="#(part._.Defining_equality)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><h5 class="heading">7.1.1<tt>&nbsp;</tt><a name="(part._.Getting_started)"></a>Getting started<span class="button-group"><a href="#(part._.Getting_started)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>For this part of the lab we will work with classes that define bank accounts: a checking, savings or credit line
account. Download the <span class="stt">Banking.zip</span> file
that represents this class hierarchy and
start a new project. Make two examples of each type of
account as well as examples of lists of accounts and banks.</p><p><span style="font-weight: bold">Implementing the <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjIdentifier">sameBank</span><span class="RktMeta"></span></span></span> method</span></p><p>Our object is to define a method that will determine whether a given <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Bank</span><span class="RktMeta"></span></span></span> is the same
as this <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Bank</span><span class="RktMeta"></span></span></span>. We will need methods to compare lists of accounts
and all accounts in them.</p><p>Of course, now that we have the abstract class it would be easy to compare just account numbers
and the name on the account, but we want to make sure that all the customer&rsquo;s data matches
what we have on file exactly, including balances, interest rates, etc.</p><p>We will design the method <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjIdentifier">same</span><span class="RktMeta"></span></span></span> similar to the technique described in the lecture,
<span class="emph">sameness by double dispatch</span>. The relevant examples can be found in the lecture notes.
You may want to look at the code there as you work through this problem.</p><h5 class="heading">7.2<tt>&nbsp;</tt><a name="(part._.Two_approaches__bad_and_good)"></a>Two approaches: bad and good<span class="button-group"><a href="#(part._.Two_approaches__bad_and_good)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><h5 class="heading">7.2.1<tt>&nbsp;</tt><a name="(part._.Bad_.Option_-_.Incorrect_alternative_)"></a>Bad Option - Incorrect alternative:<span class="button-group"><a href="#(part._.Bad_.Option_-_.Incorrect_alternative_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>A method to compare Accounts can be badly written with two features of the Java language: the <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjKeyword">instanceof</span><span class="RktMeta"></span></span></span>
    operator and casting. In the <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Checking</span><span class="RktMeta"></span></span></span> class this style method would look like the following:</p><div class="JavaHighlightBlock"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="ProfjComment">// Is the given Account the same as this Checking?
</span><span class="ProfjPrimType">boolean</span><span class="ProfjWhiteSpace"> </span><span class="ProfjIdentifier">sameAccount</span><span class="ProfjKeyword">(</span><span class="ProfjType">Account</span><span class="ProfjWhiteSpace"> </span><span class="ProfjIdentifier">that</span><span class="ProfjKeyword">)</span><span class="ProfjKeyword">{</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">if</span><span class="ProfjKeyword">(</span><span class="ProfjIdentifier">that</span><span class="ProfjWhiteSpace"> </span><span class="ProfjKeyword">instanceof</span><span class="ProfjWhiteSpace"> </span><span class="ProfjType">Checking</span><span class="ProfjKeyword">)</span><span class="ProfjKeyword">{</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">    </span><span class="ProfjKeyword">return</span><span class="ProfjWhiteSpace"> </span><span class="ProfjKeyword">this</span><span class="ProfjDefault">.</span><span class="ProfjIdentifier">sameChecking</span><span class="ProfjKeyword">(</span><span class="ProfjKeyword">(</span><span class="ProfjType">Checking</span><span class="ProfjKeyword">)</span><span class="ProfjIdentifier">that</span><span class="ProfjKeyword">)</span><span class="ProfjDefault">;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">else</span><span class="ProfjWhiteSpace"> </span><span class="ProfjKeyword">{</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">    </span><span class="ProfjKeyword">return</span><span class="ProfjWhiteSpace"> </span><span class="ProfjLiteral">false</span><span class="ProfjDefault">;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjKeyword">}</span><span class="RktMeta"></span></td></tr></table></blockquote></div><p>However, this version introduces bugs!</p><p>The issue is that any class that later extends <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Checking</span><span class="RktMeta"></span></span></span>, say a <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">PremiumChecking</span><span class="RktMeta"></span></span></span> class,
    will also be considered a <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Checking</span><span class="RktMeta"></span></span></span> instance by the <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjKeyword">instanceof</span><span class="RktMeta"></span></span></span> operator.</p><p>If we implement a similar same method in <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">PremiumChecking</span><span class="RktMeta"></span></span></span>:</p><div class="JavaHighlightBlock"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="ProfjComment">// Is the given Account the same as this PremiumChecking?
</span><span class="ProfjPrimType">boolean</span><span class="ProfjWhiteSpace"> </span><span class="ProfjIdentifier">sameAccount</span><span class="ProfjKeyword">(</span><span class="ProfjType">Account</span><span class="ProfjWhiteSpace"> </span><span class="ProfjIdentifier">that</span><span class="ProfjKeyword">)</span><span class="ProfjKeyword">{</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">if</span><span class="ProfjKeyword">(</span><span class="ProfjIdentifier">that</span><span class="ProfjWhiteSpace"> </span><span class="ProfjKeyword">instanceof</span><span class="ProfjWhiteSpace"> </span><span class="ProfjType">PremiumChecking</span><span class="ProfjKeyword">)</span><span class="ProfjKeyword">{</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">    </span><span class="ProfjKeyword">return</span><span class="ProfjWhiteSpace"> </span><span class="ProfjKeyword">this</span><span class="ProfjDefault">.</span><span class="ProfjIdentifier">samePremChecking</span><span class="ProfjKeyword">(</span><span class="ProfjKeyword">(</span><span class="ProfjType">PremiumChecking</span><span class="ProfjKeyword">)</span><span class="ProfjIdentifier">that</span><span class="ProfjKeyword">)</span><span class="ProfjDefault">;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">else</span><span class="ProfjWhiteSpace"> </span><span class="ProfjKeyword">{</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">    </span><span class="ProfjKeyword">return</span><span class="ProfjWhiteSpace"> </span><span class="ProfjLiteral">false</span><span class="ProfjDefault">;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjWhiteSpace">  </span><span class="ProfjKeyword">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="ProfjKeyword">}</span><span class="RktMeta"></span></td></tr></table></blockquote></div><p>Now only a <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">PremiumChecking</span><span class="RktMeta"></span></span></span> object can be the <span class="emph">same</span> as the <span class="emph">given</span> instance of the
<span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">PremiumChecking</span><span class="RktMeta"></span></span></span> class.</p><p>But an instance of the <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Checking</span><span class="RktMeta"></span></span></span> class can be the same as the given instance of the <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">PremiumChecking</span><span class="RktMeta"></span></span></span>
class!</p><p>These kinds of bugs can cause serious problems.</p><h5 class="heading">7.2.2<tt>&nbsp;</tt><a name="(part._.Good_.Option_-_.A_.Better_alternative_)"></a>Good Option - A Better alternative:<span class="button-group"><a href="#(part._.Good_.Option_-_.A_.Better_alternative_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>In <a href="lecture12.html" data-pltdoc="x"><span class="LectureNum">Lecture 12:</span> Defining sameness for complex data, part 2</a> we introduced another approach that works better. It requires us to add a new method to the
<span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjKeyword">abstract</span><span class="RktMeta"></span></span></span> class for each subclass of <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjType">Account</span><span class="RktMeta"></span></span></span>, and relies on <span class="emph">double dispatch</span>
to produce the correct answer.  Following your notes from class, implement the helpers for <span class="RktBlk"><span class="JavaHighlight"><span class="RktMeta"></span><span class="ProfjIdentifier">sameBank</span><span class="RktMeta"></span></span></span>
using double dispatch.  Make sure to test all the methods very well.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="lab6.html" title="backward to &quot;Lab 6: Working with Cyclic Data&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Lab_Materials.html" title="up to &quot;Lab Materials&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="lab8.html" title="forward to &quot;Lab 8: Parametric data and visitors&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>