<!DOCTYPE html>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Lecture 5: Relational Specifications</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="minted.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="minted-default-style.css" title="default"/><link rel="stylesheet" type="text/css" href="main.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Logic &amp; Computation</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a></td></tr><tr><td align="right"></td><td><a href="schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a></td></tr><tr><td align="right"></td><td><a href="lectures.html" class="tocviewselflink" data-pltdoc="x">Lectures</a></td></tr><tr><td align="right"></td><td><a href="homework.html" class="tocviewlink" data-pltdoc="x">Homework</a></td></tr><tr><td align="right"></td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Lean Tactic Reference</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="l1.html" class="tocviewlink" data-pltdoc="x">Lecture 1:<span class="mywbr"> &nbsp;</span> Intro</a></td></tr><tr><td align="right"></td><td><a href="l2.html" class="tocviewlink" data-pltdoc="x">Lecture 2:<span class="mywbr"> &nbsp;</span> Logistics, Specifications in ISL</a></td></tr><tr><td align="right"></td><td><a href="l3.html" class="tocviewlink" data-pltdoc="x">Lecture 3:<span class="mywbr"> &nbsp;</span> Propositional Logic in Code</a></td></tr><tr><td align="right"></td><td><a href="l4.html" class="tocviewlink" data-pltdoc="x">Lecture 4:<span class="mywbr"> &nbsp;</span> Design /<span class="mywbr"> &nbsp;</span> Specification Recipe</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Lecture 5:<span class="mywbr"> &nbsp;</span> Relational Specifications</a></td></tr><tr><td align="right"></td><td><a href="l6.html" class="tocviewlink" data-pltdoc="x">Lecture 6:<span class="mywbr"> &nbsp;</span> For-<wbr></wbr>all, Intro to PBT</a></td></tr><tr><td align="right"></td><td><a href="l7.html" class="tocviewlink" data-pltdoc="x">Lecture 7:<span class="mywbr"> &nbsp;</span> ==&gt;, PBT filtering</a></td></tr><tr><td align="right"></td><td><a href="l8.html" class="tocviewlink" data-pltdoc="x">Lecture 8:<span class="mywbr"> &nbsp;</span> PBT generators</a></td></tr><tr><td align="right"></td><td><a href="l9.html" class="tocviewlink" data-pltdoc="x">Lecture 9:<span class="mywbr"> &nbsp;</span> SAT</a></td></tr><tr><td align="right"></td><td><a href="l10.html" class="tocviewlink" data-pltdoc="x">Lecture 10:<span class="mywbr"> &nbsp;</span> SMT &amp; Rosette</a></td></tr><tr><td align="right"></td><td><a href="l11.html" class="tocviewlink" data-pltdoc="x">Lecture 11:<span class="mywbr"> &nbsp;</span> Rosette &amp; Finitization</a></td></tr><tr><td align="right"></td><td><a href="l12.html" class="tocviewlink" data-pltdoc="x">Lecture 12:<span class="mywbr"> &nbsp;</span> Higher order logic</a></td></tr><tr><td align="right"></td><td><a href="l13.html" class="tocviewlink" data-pltdoc="x">Lecture 13:<span class="mywbr"> &nbsp;</span> Functions</a></td></tr><tr><td align="right"></td><td><a href="l14.html" class="tocviewlink" data-pltdoc="x">Lecture 14:<span class="mywbr"> &nbsp;</span> Propositional logic</a></td></tr><tr><td align="right"></td><td><a href="l15.html" class="tocviewlink" data-pltdoc="x">Lecture 15:<span class="mywbr"> &nbsp;</span> Propositional logic &amp; programming</a></td></tr><tr><td align="right"></td><td><a href="l16.html" class="tocviewlink" data-pltdoc="x">Lecture 16:<span class="mywbr"> &nbsp;</span> Exam 1, Part A</a></td></tr><tr><td align="right"></td><td><a href="l17.html" class="tocviewlink" data-pltdoc="x">Lecture 17:<span class="mywbr"> &nbsp;</span> Exam 1, Part B</a></td></tr><tr><td align="right"></td><td><a href="l18.html" class="tocviewlink" data-pltdoc="x">Lecture 18:<span class="mywbr"> &nbsp;</span> Proving with tactics</a></td></tr><tr><td align="right"></td><td><a href="l19.html" class="tocviewlink" data-pltdoc="x">Lecture 19:<span class="mywbr"> &nbsp;</span> Inductive types &amp; proofs</a></td></tr><tr><td align="right"></td><td><a href="l20.html" class="tocviewlink" data-pltdoc="x">Lecture 20:<span class="mywbr"> &nbsp;</span> Lists</a></td></tr><tr><td align="right"></td><td><a href="l21.html" class="tocviewlink" data-pltdoc="x">Lecture 21:<span class="mywbr"> &nbsp;</span>  Proof Practice</a></td></tr><tr><td align="right"></td><td><a href="l22.html" class="tocviewlink" data-pltdoc="x">Lecture 22:<span class="mywbr"> &nbsp;</span> Generalizing hypotheses</a></td></tr><tr><td align="right"></td><td><a href="l23.html" class="tocviewlink" data-pltdoc="x">Lecture 23:<span class="mywbr"> &nbsp;</span> Generalize</a></td></tr><tr><td align="right"></td><td><a href="l24.html" class="tocviewlink" data-pltdoc="x">Lecture 24:<span class="mywbr"> &nbsp;</span> Standard Libraries</a></td></tr><tr><td align="right"></td><td><a href="l25.html" class="tocviewlink" data-pltdoc="x">Lecture 25:<span class="mywbr"> &nbsp;</span> Forward Reasoning</a></td></tr><tr><td align="right"></td><td><a href="l26.html" class="tocviewlink" data-pltdoc="x">Lecture 26:<span class="mywbr"> &nbsp;</span> Proof Automation</a></td></tr><tr><td align="right"></td><td><a href="l27.html" class="tocviewlink" data-pltdoc="x">Lecture 27:<span class="mywbr"> &nbsp;</span> Compiler Correctness</a></td></tr><tr><td align="right"></td><td><a href="l28.html" class="tocviewlink" data-pltdoc="x">Lecture 28:<span class="mywbr"> &nbsp;</span> Induction</a></td></tr><tr><td align="right"></td><td><a href="l29.html" class="tocviewlink" data-pltdoc="x">Lecture 29:<span class="mywbr"> &nbsp;</span> Functions vs. Relations</a></td></tr><tr><td align="right"></td><td><a href="l30.html" class="tocviewlink" data-pltdoc="x">Lecture 30:<span class="mywbr"> &nbsp;</span> Why logic?</a></td></tr><tr><td align="right"></td><td><a href="l31.html" class="tocviewlink" data-pltdoc="x">Lecture 31:<span class="mywbr"> &nbsp;</span> Linear Logic</a></td></tr><tr><td align="right"></td><td><a href="l32.html" class="tocviewlink" data-pltdoc="x">Lecture 32</a></td></tr><tr><td align="right"></td><td><a href="l33.html" class="tocviewlink" data-pltdoc="x">Lecture 33</a></td></tr><tr><td align="right"></td><td><a href="l34.html" class="tocviewlink" data-pltdoc="x">Lecture 34</a></td></tr><tr><td align="right"></td><td><a href="l35.html" class="tocviewlink" data-pltdoc="x">Lecture 35:<span class="mywbr"> &nbsp;</span> Exam 2, Part A</a></td></tr><tr><td align="right"></td><td><a href="l36.html" class="tocviewlink" data-pltdoc="x">Lecture 36:<span class="mywbr"> &nbsp;</span> Exam 2, Part B</a></td></tr><tr><td align="right"></td><td><a href="l37.html" class="tocviewlink" data-pltdoc="x">Lecture 37</a></td></tr><tr><td align="right"></td><td><a href="l38.html" class="tocviewlink" data-pltdoc="x">Lecture 38</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Lecture 5:<span class="mywbr"> &nbsp;</span> Relational Specifications</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Purpose%29" class="tocviewlink" data-pltdoc="x">Purpose</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Outline%29" class="tocviewlink" data-pltdoc="x">Outline</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Purpose%29" class="tocsubseclink" data-pltdoc="x">Purpose</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Outline%29" class="tocsubseclink" data-pltdoc="x">Outline</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.7</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="l4.html" title="backward to &quot;Lecture 4: Design / Specification Recipe&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l6.html" title="forward to &quot;Lecture 6: For-all, Intro to PBT&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4><a name="(part._l5)"></a>Lecture 5: Relational Specifications</h4><h5>1<tt>&nbsp;</tt><a name="(part._.Purpose)"></a>Purpose</h5><p>Reinforce design / specification recipe, leading towards PBT.</p><h5>2<tt>&nbsp;</tt><a name="(part._.Outline)"></a>Outline</h5><p><span class="Larger">Soundness &amp; Completeness</span></p><p>We can distinguish between proof and truth. A logical system allows us to prove certain things, whereas
truth is a notion outside of any particular mechanism of proof.</p><p>Consider the halting problem. Any given program in a deterministic language either halts or doesn&rsquo;t halt (truth),
but the halting problem famously showed that there is no program that, given an arbitrary program as
input, can determine if that program halts (proof).</p><p>Or, the collatz conjecture. Does this program terminate for all input? Clearly, there is an answer
(either it does or doesn&rsquo;t), but in this case, we don&rsquo;t even know, and we certainly don&rsquo;t know how
to prove it. If you do, would be very cool!</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">collatz</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">n</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">even?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">collatz</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">collatz</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span><span class="w"></span>

<span class="c1">;; collatz-trace : Number -&gt; [List-of Number]</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">collatz-trace</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">even?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="n">collatz-trace</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="n">collatz-trace</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">))))))</span><span class="w"></span>
</pre></div>
</div><p>We can relate these two ideas with two words: soundness and completeness. In logic, a proof system is
sound if all <span style="font-style: italic">provable</span> statements are <span style="font-style: italic">true</span>, but there may be <span style="font-style: italic">true</span> statements
that are not <span style="font-style: italic">provable</span>. A proof system is complete if all <span style="font-style: italic">true</span> statements are provable,
but possibly there are <span style="font-style: italic">false</span> statements that are also provable. Clearly, the best case is a
sound and complete proof system, but such things may not be possible.</p><p>The same idea applies to specifications.</p><p>A specification is sound if it all implementations that it admits are correct (this is our notion of "truth"),
but it may not admit all correct implememations.</p><p>A specification is complete if it admits all correct implementations (our notion of truth), but it may also
admit incorrect implementations.</p><p><span class="Larger">Error correction</span></p><p>Now, let&rsquo;s look at another example. Let&rsquo;s consider an important problem: how to recover data that
is corrupted. This is incredibly important for radio transmision, as wireless signals are prone to
interference, but there are many other applications.</p><p>This is always done by introducing some amount of redundancy in the data. A simple way to do this,
known as a repetition code, involves repeating the data multiple times.</p><p>Let&rsquo;s say we have a sequence of bits, represented as:</p><div class="default"><div class="highlight"><pre><span></span><span class="c1">; A Bit is one of:</span><span class="w"></span>
<span class="c1">; - 0</span><span class="w"></span>
<span class="c1">; - 1</span><span class="w"></span>

<span class="c1">; A Packet is a Bit</span><span class="w"></span>

<span class="c1">; A Message is a [List-of Packet]</span><span class="w"></span>
</pre></div>
</div><p>We want to be able to correct some amount of errors. In particular, we&rsquo;ll split our <span class="RktSym">BitString</span><span class="RktMeta"></span>
into "packets", each a single bit, and our goal is to be able to introduce a single error (randomly) into each packet. If we did this without changing the data, there would be no way of recovering, as a single change would change the entire packet. But, we will first encode the packets into a larger packet (of size 3), then introduce the error, and then decode. Our goal is to be able to recover the original message regardless of how (or if) the errors are introduced.</p><p>Let&rsquo;s formally specify what we just described in English:</p><div class="default"><div class="highlight"><pre><span></span><span class="c1">; A TripletPacket is a (list Bit Bit Bit)</span><span class="w"></span>

<span class="c1">; encode : Packet -&gt; TripletPacket</span><span class="w"></span>
<span class="c1">; ...</span><span class="w"></span>
<span class="c1">; decode : TripletPacket -&gt; Packet</span><span class="w"></span>
<span class="c1">; ...</span><span class="w"></span>

<span class="c1">; message-recovery-prop : Message -&gt; Bool</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">message-recovery-prop</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">local</span><span class="w"> </span><span class="p">[(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">mutate</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">introduce-error</span><span class="w"> </span><span class="n">triplet</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="k">local</span><span class="w"> </span><span class="p">[(</span><span class="k">define</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="p">(</span><span class="nb">random</span><span class="w"> </span><span class="mi">4</span><span class="p">))]</span><span class="w"></span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">mutate</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">list-ref</span><span class="w"> </span><span class="n">triplet</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="n">mutate</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">list-ref</span><span class="w"> </span><span class="n">triplet</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                    </span><span class="p">(</span><span class="n">mutate</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">list-ref</span><span class="w"> </span><span class="n">triplet</span><span class="w"> </span><span class="mi">2</span><span class="p">)))))]</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="p">(</span><span class="n">decode</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">introduce-error</span><span class="w"> </span><span class="p">(</span><span class="n">encode</span><span class="w"> </span><span class="n">msg</span><span class="p">)))</span><span class="w"> </span><span class="n">msg</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div><p>Note that at this point, we&rsquo;ve described the data (that we&rsquo;ll allow three bits), and how we want
encoding / decoding to be able to handle errors (up to one bit mutation without any loss of information),
but we haven&rsquo;t said anything about the implementation.</p><p>In this case, the implementation is pretty straightforward: we simply duplicate the bit, and to decode, take the majority. We can then check that the property holds with a few examples.</p><div class="default"><div class="highlight"><pre><span></span><span class="c1">; encode : [List-of Packet] -&gt; [List-of TripletPacket]</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">encode</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="n">msg</span><span class="p">))</span><span class="w"></span>

<span class="c1">; decode : [List-of TripletPacket] -&gt; [List-of Packet]</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">decode</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">foldr</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">msg</span><span class="p">))</span><span class="w"></span>

<span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">message-recovery-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">message-recovery-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div><p>Now, it&rsquo;s a little bit dissappointing that we are checking this property with just a few, hand-chosen
messages. We&rsquo;ll come back to that.</p><p><span class="Larger">Specification</span>
Last time, we introduced the idea of a specification, and how it fits into the design recipe.
Specifications allow us to express, precisely in code, the behavior of our functions. This is
more precise than in text, and can be more obvious to understand than in unit tests, even if we
include many many unit tests. Indeed, for the <span class="RktSym">color-&gt;b&amp;w</span><span class="RktMeta"></span> example from last class, we
_could_ have included unit tests for all of the inputs, but seeing:</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">color-&gt;b&amp;w</span><span class="w"> </span><span class="n">RED</span><span class="p">)</span><span class="w"> </span><span class="mf">76.245</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">color-&gt;b&amp;w</span><span class="w"> </span><span class="n">BLUE</span><span class="p">)</span><span class="w"> </span><span class="mf">29.07</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">color-&gt;b&amp;w</span><span class="w"> </span><span class="n">GREEN</span><span class="p">)</span><span class="w"> </span><span class="mf">149.685</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">color-&gt;b&amp;w</span><span class="w"> </span><span class="n">YELLOW</span><span class="p">)</span><span class="w"> </span><span class="mf">225.93</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">color-&gt;b&amp;w</span><span class="w"> </span><span class="n">PURPLE</span><span class="p">)</span><span class="w"> </span><span class="mf">105.315</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div><p>Is not particularly informative. It doesn&rsquo;t communicate, in particular, that what we <span style="font-style: italic">want</span>
is that the distance between any pair of colors is at least 20 points of luminance. And indeed, if
we add a new color, nothing in these tests will let us know that we should be aiming to mantain that
invariant. Whereas, with our specification, adding a new color will immediately cause the tests
for all the other colors to ensure that they are distinguishable from our new color.</p><p><span class="Larger">Beyond comprehension</span>, there are some specifications that we simply cannot express as unit
tests. Recall the function <span class="RktSym">shortest-string</span><span class="RktMeta"></span> from last week:</p><div class="default"><div class="highlight"><pre><span></span><span class="c1">; shortest-string : [List-of String] -&gt; String or #f</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">shortest-string</span><span class="w"> </span><span class="n">los</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">...</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">shortest-string-prop</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">([</span><span class="n">min-len</span><span class="w"> </span><span class="p">(</span><span class="nb">string-length</span><span class="w"> </span><span class="p">(</span><span class="n">shortest-string</span><span class="w"> </span><span class="n">l</span><span class="p">))])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nb">andmap</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="nb">string-length</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">min-len</span><span class="p">))</span><span class="w"> </span><span class="n">l</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">shortest-string-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="w"> </span><span class="s2">&quot;bb&quot;</span><span class="w"> </span><span class="s2">&quot;CCC&quot;</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">shortest-string-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">shortest-string-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="s2">&quot;aa&quot;</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="w"> </span><span class="s2">&quot;c&quot;</span><span class="w"> </span><span class="s2">&quot;dd&quot;</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div><p>If we wish to express that our function returns the shortest string in the list, we need to be able
to account for the fact that there could be multiple shortest strings. One possible way to do this with unit tests is that we
specify that we want the <span style="font-style: italic">first</span> shortest string, or the <span style="font-style: italic">last</span>, or the <span style="font-style: italic">nth</span>,
in the case of a tie. But this is an unpleasant thing to do when writing a specification, because
we are <span style="font-style: italic">overspecifying</span>: we are including details that are not relevant. A user of this
function shouldn&rsquo;t care, as any of those options are fine! By switching to express this as a
property, we get away from this problem, as we can directly express this property.</p><p>Technically, what this allows us to do is express <span style="font-style: italic">relational</span> properties. Unit tests can only
express function input/output pairs, which means, in particular, that while multiple inputs can map
to the same output, a single input cannot map to multiple outputs. Often, this is fine, but sometimes,
we want to be able to express exactly this: that there is a <span style="font-style: italic">relation</span> between the input and output,
captured by some predicate. In this case, the predicate is that the output is at least as short as any other string
in the input list.</p><p><span class="Larger">Can you think of any other relational properties?</span></p><p><span class="Larger">Think about sorting</span>. Say you have a data definition for a person, with a name and an age:</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define-struct</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="w"> </span><span class="n">age</span><span class="p">])</span><span class="w"></span>
<span class="c1">; A Person is a (make-person String Number)</span><span class="w"></span>
</pre></div>
</div><p>And you want to write a function <span class="RktSym">sort-people</span><span class="RktMeta"></span> that sorts people by their age, ascending:</p><div class="default"><div class="highlight"><pre><span></span><span class="c1">;; sort-people : [List-of Person] -&gt; [List-of Person]</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people</span><span class="w"> </span><span class="n">lop</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div><p>Writing unit tests for this is problematic, as you end up with multiple possibilities:</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)))</span><span class="w"></span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="n">check-expect</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)))</span><span class="w"></span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div><p>Both of these options are <span style="font-style: italic">correct</span>, and indeed, if you want to allow different sorting algorithms,
it&rsquo;s probably quite important not to enforce a certain ordering of otherwise equivalent elements.</p><p>How do we avoid this? By defining the notion of <span style="font-style: italic">sortedness</span> as a property, and making our specification
be that <span class="RktSym">sort-people</span><span class="RktMeta"></span> results in a sorted list!</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sorted</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"></span>
<span class="w">    </span><span class="p">[(</span><span class="nb">empty?</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">[(</span><span class="nb">cons?</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="nb">andmap</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">person-age</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">person-age</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">l</span><span class="p">))))</span><span class="w"></span>
<span class="w">                            </span><span class="p">(</span><span class="nb">rest</span><span class="w"> </span><span class="n">l</span><span class="p">))</span><span class="w"></span>
<span class="w">                    </span><span class="p">(</span><span class="n">sort-people-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">rest</span><span class="w"> </span><span class="n">l</span><span class="p">)))]))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people-prop</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">sorted</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people</span><span class="w"> </span><span class="n">l</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div><p>What is this expressing? That for every element in the list, everything later in the list has an age greater than
or equal to it. That captures the notion of sortedness.</p><p>Now I can write tests in a form that allows any correct sorting algorithm:</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people-prop</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">make-person</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="w"> </span><span class="mi">19</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div><p>Now, when we are coming up with these specifications, we do have to be careful: one benefit of unit tests is that
they had us think about the input &amp; the output, and write them down carefully. Just as our code can have bugs, so
can our specifications, and they may not be obvious, at first. So often, we want to still include unit tests. In
this case, it would be good to have unit tests for lists that did not have duplicate ages (and thus did not result)
in ambiguity.</p><p>But if we just look at the specification, do we see any issue?</p><p><span class="Larger">One problem:</span> we are no longer ensuring that the same elements, or even any elements, come out of
our function. We could define <span class="RktSym">sort-people</span><span class="RktMeta"></span> to return the empty list on all input and it would pass this
specification, as indeed, the empty list is sorted!</p><p>Clearly, if we included some unit tests, we would rule out that possibility, but we can also extend our property to
include other details. For example, we might want to ensure that the length of the input &amp; output lists were the same,
and that all elements in the input occurred somewhere in the output.</p><p>Figure out how to write those two as properties, and extend <span class="RktSym">sort-people-prop</span><span class="RktMeta"></span> to include them both.</p><div class="default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">elements-in?</span><span class="w"> </span><span class="n">l1</span><span class="w"> </span><span class="n">l2</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">andmap</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">ormap</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="n">p2</span><span class="p">))</span><span class="w"> </span><span class="n">l2</span><span class="p">))</span><span class="w"> </span><span class="n">l1</span><span class="p">))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people-prop1</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">local</span><span class="w"> </span><span class="p">[(</span><span class="k">define</span><span class="w"> </span><span class="n">SORTED</span><span class="w"> </span><span class="p">(</span><span class="n">sort-people</span><span class="w"> </span><span class="n">l</span><span class="p">))]</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">sorted</span><span class="w"> </span><span class="n">SORTED</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="n">SORTED</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="n">elements-in?</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">SORTED</span><span class="p">)))))</span><span class="w"></span>
</pre></div>
</div><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="l4.html" title="backward to &quot;Lecture 4: Design / Specification Recipe&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l6.html" title="forward to &quot;Lecture 6: For-all, Intro to PBT&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>