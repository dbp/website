<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <title>
   dbp.io
  </title>
  <link rel="stylesheet" type="text/css" href="scribble.css" title="default">
  <link rel="stylesheet" type="text/css" href="racket.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-racket.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted-default-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="main.css" title="default">
  <script type="text/javascript" src="scribble-common.js"></script>
  <script type="text/javascript" src="manual-racket.js"></script>
 </head>
 <body id="scribble-racket-lang-org">
  <div class="tocset">
   <div class="tocview">
    <div class="tocviewlist tocviewlisttopspace">
     <div class="tocviewtitle">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td style="width: 1em;">
          <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">►</a>
         </td>
         <td></td>
         <td>
          <a href="index.html" class="tocviewlink" data-pltdoc="x">Logic &amp; Computation</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <div class="tocviewsublisttop" style="display: none;" id="tocview_0">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="lectures.html" class="tocviewselflink" data-pltdoc="x">Lectures</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="homework.html" class="tocviewlink" data-pltdoc="x">Homework</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="ref.html" class="tocviewlink" data-pltdoc="x">Lean Tactic Reference</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">▼</a>
        </td>
        <td></td>
        <td>
         <a href="lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublist" style="display: block;" id="tocview_1">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l1.html" class="tocviewlink" data-pltdoc="x">Lecture 1:<span class="mywbr"> &nbsp;</span> Intro</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l2.html" class="tocviewlink" data-pltdoc="x">Lecture 2:<span class="mywbr"> &nbsp;</span> Logistics, Specifications in ISL</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l3.html" class="tocviewlink" data-pltdoc="x">Lecture 3:<span class="mywbr"> &nbsp;</span> Propositional Logic in Code</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l4.html" class="tocviewlink" data-pltdoc="x">Lecture 4:<span class="mywbr"> &nbsp;</span> Design /<span class="mywbr"> &nbsp;</span> Specification Recipe</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l5.html" class="tocviewlink" data-pltdoc="x">Lecture 5:<span class="mywbr"> &nbsp;</span> Relational Specifications</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l6.html" class="tocviewlink" data-pltdoc="x">Lecture 6:<span class="mywbr"> &nbsp;</span> For-<wbr>all, Intro to PBT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 7:<span class="mywbr"> &nbsp;</span> ==&gt;, PBT filtering</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l8.html" class="tocviewlink" data-pltdoc="x">Lecture 8:<span class="mywbr"> &nbsp;</span> PBT generators</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l9.html" class="tocviewlink" data-pltdoc="x">Lecture 9:<span class="mywbr"> &nbsp;</span> SAT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l10.html" class="tocviewlink" data-pltdoc="x">Lecture 10:<span class="mywbr"> &nbsp;</span> SMT &amp; Rosette</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l11.html" class="tocviewlink" data-pltdoc="x">Lecture 11:<span class="mywbr"> &nbsp;</span> Rosette &amp; Finitization</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l12.html" class="tocviewlink" data-pltdoc="x">Lecture 12:<span class="mywbr"> &nbsp;</span> Higher order logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l13.html" class="tocviewlink" data-pltdoc="x">Lecture 13:<span class="mywbr"> &nbsp;</span> Functions</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l14.html" class="tocviewlink" data-pltdoc="x">Lecture 14:<span class="mywbr"> &nbsp;</span> Propositional logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l15.html" class="tocviewlink" data-pltdoc="x">Lecture 15:<span class="mywbr"> &nbsp;</span> Propositional logic &amp; programming</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l16.html" class="tocviewlink" data-pltdoc="x">Lecture 16:<span class="mywbr"> &nbsp;</span> Exam 1, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l17.html" class="tocviewlink" data-pltdoc="x">Lecture 17:<span class="mywbr"> &nbsp;</span> Exam 1, Part B</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l18.html" class="tocviewlink" data-pltdoc="x">Lecture 18:<span class="mywbr"> &nbsp;</span> Proving with tactics</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l19.html" class="tocviewlink" data-pltdoc="x">Lecture 19:<span class="mywbr"> &nbsp;</span> Inductive types &amp; proofs</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l20.html" class="tocviewlink" data-pltdoc="x">Lecture 20:<span class="mywbr"> &nbsp;</span> Lists</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l21.html" class="tocviewlink" data-pltdoc="x">Lecture 21:<span class="mywbr"> &nbsp;</span>  Proof Practice</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l22.html" class="tocviewlink" data-pltdoc="x">Lecture 22:<span class="mywbr"> &nbsp;</span> Generalizing hypotheses</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l23.html" class="tocviewlink" data-pltdoc="x">Lecture 23:<span class="mywbr"> &nbsp;</span> Generalize</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l24.html" class="tocviewlink" data-pltdoc="x">Lecture 24:<span class="mywbr"> &nbsp;</span> Standard Libraries</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l25.html" class="tocviewlink" data-pltdoc="x">Lecture 25:<span class="mywbr"> &nbsp;</span> Forward Reasoning</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l26.html" class="tocviewlink" data-pltdoc="x">Lecture 26:<span class="mywbr"> &nbsp;</span> Proof Automation</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l27.html" class="tocviewlink" data-pltdoc="x">Lecture 27:<span class="mywbr"> &nbsp;</span> Compiler Correctness</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l28.html" class="tocviewlink" data-pltdoc="x">Lecture 28:<span class="mywbr"> &nbsp;</span> Induction</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l29.html" class="tocviewlink" data-pltdoc="x">Lecture 29:<span class="mywbr"> &nbsp;</span> Functions vs. Relations</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l30.html" class="tocviewlink" data-pltdoc="x">Lecture 30:<span class="mywbr"> &nbsp;</span> Why logic?</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l31.html" class="tocviewlink" data-pltdoc="x">Lecture 31:<span class="mywbr"> &nbsp;</span> Linear Logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l32.html" class="tocviewlink" data-pltdoc="x">Lecture 32</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l33.html" class="tocviewlink" data-pltdoc="x">Lecture 33</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l34.html" class="tocviewlink" data-pltdoc="x">Lecture 34</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l35.html" class="tocviewlink" data-pltdoc="x">Lecture 35:<span class="mywbr"> &nbsp;</span> Exam 2, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l36.html" class="tocviewlink" data-pltdoc="x">Lecture 36:<span class="mywbr"> &nbsp;</span> Exam 2, Part B</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l37.html" class="tocviewlink" data-pltdoc="x">Lecture 37</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l38.html" class="tocviewlink" data-pltdoc="x">Lecture 38</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">►</a>
        </td>
        <td></td>
        <td>
         <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 7:<span class="mywbr"> &nbsp;</span> ==&gt;, PBT filtering</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublistbottom" style="display: none;" id="tocview_2">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right">
          1&nbsp;
         </td>
         <td>
          <a href="#%28part._.Purpose%29" class="tocviewlink" data-pltdoc="x">Purpose</a>
         </td>
        </tr>
        <tr>
         <td align="right">
          2&nbsp;
         </td>
         <td>
          <a href="#%28part._.Outline%29" class="tocviewlink" data-pltdoc="x">Outline</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div>
   <div class="tocsub">
    <div class="tocsubtitle">
     On this page:
    </div>
    <table class="tocsublist" cellspacing="0">
     <tbody>
      <tr>
       <td>
        <span class="tocsublinknumber">1
        <tt>
         &nbsp;
        </tt>
       </span>
       <a href="#%28part._.Purpose%29" class="tocsubseclink" data-pltdoc="x">Purpose</a>
      </td>
     </tr>
     <tr>
      <td>
       <span class="tocsublinknumber">2
       <tt>
        &nbsp;
       </tt>
      </span>
      <a href="#%28part._.Outline%29" class="tocsubseclink" data-pltdoc="x">Outline</a>
     </td>
    </tr>
   </tbody>
  </table>
 </div>
</div>
<div class="maincolumn">
 <div class="main">
  <div class="versionbox">
   <span class="version">8.7</span>
  </div>
  <div class="navsettop">
   <span class="navleft">
   <div class="nosearchform"></div>
   &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
  </span>
  <span class="navright">&nbsp;&nbsp;<a href="l6.html" title="backward to &quot;Lecture 6: For-all, Intro to PBT&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l8.html" title="forward to &quot;Lecture 8: PBT generators&quot;" data-pltdoc="x">next →</a></span>&nbsp;
 </div>
 <h4>
  <a name="(part._l7)"></a>Lecture 7: ==&gt;, PBT filtering
 </h4>
 <h5>
  1
  <tt>
   &nbsp;
  </tt>
  <a name="(part._.Purpose)"></a>Purpose
 </h5>
 <p>
  Show <span class="RktSym">==&gt;</span><span class="RktMeta"></span>; logical implication corresponds to <span style="font-style: italic">filtering</span> for PBT.
 </p>
 <h5>
  2
  <tt>
   &nbsp;
  </tt>
  <a name="(part._.Outline)"></a>Outline
 </h5>
 <p>
  <span class="Larger">Last time, we saw how to use <span class="RktSym">for-all</span><span class="RktMeta"></span> to generate random inputs</span>
 </p>
 <p>
  This is, in some sense, the fundamental idea of property-based testing. Between
universal quantification, which is approximated by random generation, and logical
assertions, which are realized by code that evaluates to booleans, we have a
very rich way of describing the behavior of code.
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">rev-app-helper</span><span class="w"> </span><span class="n">l1</span><span class="w"> </span><span class="n">l2</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">reverse</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="n">l1</span><span class="w"> </span><span class="n">l2</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="p">(</span><span class="nb">reverse</span><span class="w"> </span><span class="n">l2</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="nb">reverse</span><span class="w"> </span><span class="n">l1</span><span class="p">))))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">rev-app-prop</span><span class="w"> </span><span class="n">l1</span><span class="w"> </span><span class="n">l2</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[(</span><span class="n">ra</span><span class="w"> </span><span class="p">(</span><span class="n">rev-app-helper</span><span class="w"> </span><span class="n">l1</span><span class="w"> </span><span class="n">l2</span><span class="p">))]</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">ra</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">second</span><span class="w"> </span><span class="n">ra</span><span class="p">))))</span><span class="w"></span>

<span class="p">(</span><span class="n">check-property</span><span class="w"></span>
<span class="w"> </span><span class="p">(</span><span class="n">for-all</span><span class="w"> </span><span class="p">[(</span><span class="n">l1</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">l2</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])]</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="n">rev-app-prop</span><span class="w"> </span><span class="n">l1</span><span class="w"> </span><span class="n">l2</span><span class="p">)))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  One additional useful logical tool is implication. That is, a certain property may
only hold if certain preconditions also hold.
 </p>
 <p>
  For example, consider the example from our very first lecture, control software
for an automatic insulin pump:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="c1">; control : [ListOf BloodSugar] [ListOf InsulinGiven] -&gt; InsulinGiven</span><span class="w"></span>
<span class="c1">; takes history of readings, history of dosing (any further back unknown), calculates new dose</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">control</span><span class="w"> </span><span class="n">Hx</span><span class="w"> </span><span class="n">Rx</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">MAX-DOSE</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="n">lon</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">foldr</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">lon</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">average</span><span class="w"> </span><span class="n">lon</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="n">lon</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="n">lon</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">get-n-readings</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">[(</span><span class="nb">empty?</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">[(</span><span class="nb">zero?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">'</span><span class="p">()]</span><span class="w"></span>
<span class="w">                          </span><span class="p">[(</span><span class="nb">positive?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">build-list</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="p">(</span><span class="k">_</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))])]</span><span class="w"></span>
<span class="w">        </span><span class="p">[(</span><span class="nb">cons?</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">[(</span><span class="nb">zero?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">'</span><span class="p">()]</span><span class="w"></span>
<span class="w">                         </span><span class="p">[(</span><span class="nb">positive?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">                                              </span><span class="p">(</span><span class="n">get-n-readings</span><span class="w"> </span><span class="p">(</span><span class="nb">rest</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                              </span><span class="p">(</span><span class="nb">sub1</span><span class="w"> </span><span class="n">n</span><span class="p">)))])]))</span><span class="w"></span>

<span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">for-all</span><span class="w"> </span><span class="p">[(</span><span class="n">Hx</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])</span><span class="w"> </span><span class="p">(</span><span class="n">Rx</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])]</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[(</span><span class="n">already-given</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="n">get-n-readings</span><span class="w"> </span><span class="n">Rx</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="mi">1</span><span class="p">))))]</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">==&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">already-given</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">control</span><span class="w"> </span><span class="n">Hx</span><span class="w"> </span><span class="n">Rx</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="w"> </span><span class="n">already-given</span><span class="p">))))))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  Here, the property we were interested in was that given any set of readings,
the pump wouldn’t decide to exceed a certain dose over a certain time interval.
But since the historical data was also randomly generated, and is an <span style="font-style: italic">input</span>
to the function, we don’t need to consider what happens if the dose had been
exceeded in the past (as that is just random data, not anything actually produced
by the function). As a result, we add a precondition to the property using the
logical implication operator <span class="RktSym">==&gt;</span><span class="RktMeta"></span>. What this means is that if the
precondition doesn’t hold, the property is vacuously true, and thus we will only
consider violations of the property when the precondition holds.
 </p>
 <p>
  <span class="Larger">Filtering to get more sensible inputs</span>
 </p>
 <p>
  Now, while quantifying over all <span class="RktSym">Hx</span><span class="RktMeta"></span> might make sense: readings could be large or small, and
possibly the hardware that produces them could have bugs in it, but quantifying over all <span class="RktSym">Rx</span><span class="RktMeta"></span>
may be less sensible, as, in particular, we have a safety requirement (ensured by properties) that
a given dose never exceeds <span class="RktSym">MAX-DOSE</span><span class="RktMeta"></span>. So let’s include that restriction on <span class="RktSym">Rx</span><span class="RktMeta"></span> in the
precondition, to make sure that any counterexamples we get are actually plausible:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">for-all</span><span class="w"> </span><span class="p">[(</span><span class="n">Hx</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])</span><span class="w"> </span><span class="p">(</span><span class="n">Rx</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])]</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">==&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">andmap</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="n">MAX-DOSE</span><span class="p">))</span><span class="w"> </span><span class="n">Rx</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[(</span><span class="n">already-given</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="n">get-n-readings</span><span class="w"> </span><span class="n">Rx</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="mi">1</span><span class="p">))))]</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="n">==&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">already-given</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="p">)</span><span class="w">     </span>
<span class="w">              </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">control</span><span class="w"> </span><span class="n">Hx</span><span class="w"> </span><span class="n">Rx</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="w"> </span><span class="n">already-given</span><span class="p">)))))))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  Now the test passes. That seems suspect, as our <span class="RktSym">control</span><span class="RktMeta"></span> function hasn’t changed. The issue
is that of the random inputs we generated, all of those that passed the precondition did not
trigger the bug. We can certainly come up with one (e.g., <span class="RktPn">(</span><span class="RktSym">list</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktMeta"></span>), but
it turns out that this input, or one like it with zeros mixed in, is the only input that’ll violate
our spec, and our random generation
doesn’t happen to pick any of those lists.
 </p>
 <p>
  This is a weakness of PBT, but is avoidable. Any ideas how?
 </p>
 <p>
  <span class="Larger">Carefully generate random inputs</span>
The idea is that rather than randomly generating arbitrary lists of naturals (and then filtering),
we will generate only lists of naturals that seem plausible. Now, this is a risky thing to do,
as if our "seem plausible" doesn’t match reality, we may miss bugs. But it’s an important technique,
and critical to scaling PBT to real problems.
 </p>
 <p>
  We’ll talk more about this tomorrow, but we’ll get a little into it today.
 </p>
 <p>
  In addition to providing <span class="RktSym">check-property</span><span class="RktMeta"></span>, <span class="RktSym">for-all</span><span class="RktMeta"></span>, <span class="RktSym">==&gt;</span><span class="RktMeta"></span>, and a few types <span class="RktSym">Integer</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Natural</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">String</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Boolean</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ListOf</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">RecordOf</span><span class="RktMeta"></span>, ISL-Spec exports the entirely of the Racket Quickcheck library (docs at <a href="https://docs.racket-lang.org/quickcheck/">https://docs.racket-lang.org/quickcheck/</a>) with the <span class="RktSym">qc:</span><span class="RktMeta"></span> prefix.
 </p>
 <p>
  One primitive provided by the library is <span class="RktSym">qc:choose-one-of</span><span class="RktMeta"></span>, which takes a list of values
and returns one of them at random. We can use this to only return naturals 0 and 1. There is one
detail that becomes apparent when we switch to these lower-level primitives: the library
distinguishes between "arbitrary" instances, that can be shrunk, and "generators", that underly them.
While all of the built-in types (<span class="RktSym">Integer</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">String</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Boolean</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ListOf</span><span class="RktSym">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">RecordOf</span><span class="RktMeta"></span>) are arbitraries,
the combinators to build up new types are mostly generators, so usually when we drop down to using
the library directly, we’ll be using generators.
 </p>
 <p>
  We can use <span style="font-style: italic">either</span> with <span class="RktSym">for-all</span><span class="RktMeta"></span>, but we can’t pass generators to parametric arbitraries (i.e., <span class="RktSym">ListOf</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">qc:choose-one-of</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">list</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">0</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span> will give an error, because <span class="RktSym">ListOf</span><span class="RktMeta"></span> expects an <span class="RktSym">arbitrary</span><span class="RktMeta"></span>, not a <span class="RktSym">generator</span><span class="RktMeta"></span>), so
we need to use <span class="RktSym">qc:choose-list</span><span class="RktMeta"></span>, and the latter expects a size, so we used <span class="RktSym">qc:sized</span><span class="RktMeta"></span> to
have it have random size:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="n">check-property</span><span class="w"> </span><span class="p">(</span><span class="n">for-all</span><span class="w"> </span><span class="p">[(</span><span class="n">Hx</span><span class="w"> </span><span class="p">[</span><span class="n">ListOf</span><span class="w"> </span><span class="n">Natural</span><span class="p">])</span><span class="w"></span>
<span class="w">                          </span><span class="p">(</span><span class="n">Rx</span><span class="w"> </span><span class="p">[</span><span class="n">qc:sized</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">qc:choose-list</span><span class="w"> </span><span class="p">(</span><span class="n">qc:choose-one-of</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="n">n</span><span class="p">))])]</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[(</span><span class="n">already-given</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="n">get-n-readings</span><span class="w"> </span><span class="n">Rx</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="mi">1</span><span class="p">))))]</span><span class="w"></span>
<span class="w">     </span><span class="p">(</span><span class="n">==&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">already-given</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="p">)</span><span class="w">     </span>
<span class="w">          </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">control</span><span class="w"> </span><span class="n">Hx</span><span class="w"> </span><span class="n">Rx</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">MAX-DOSE-OVER-T</span><span class="w"> </span><span class="n">already-given</span><span class="p">))))))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  Now, as hoped, we get a counterexample.
 </p>
 <div class="navsetbottom">
  <span class="navleft">
  <div class="nosearchform"></div>
  &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
 </span>
 <span class="navright">&nbsp;&nbsp;<a href="l6.html" title="backward to &quot;Lecture 6: For-all, Intro to PBT&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l8.html" title="forward to &quot;Lecture 8: PBT generators&quot;" data-pltdoc="x">next →</a></span>&nbsp;
</div>
</div>
</div>
<div id="contextindicator">
&nbsp;
</div>
</body>
</html>
