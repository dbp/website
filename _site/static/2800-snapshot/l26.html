<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <title>
   dbp.io
  </title>
  <link rel="stylesheet" type="text/css" href="scribble.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-racket.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted-default-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="main.css" title="default">
  <script type="text/javascript" src="scribble-common.js"></script>
  <script type="text/javascript" src="manual-racket.js"></script>
 </head>
 <body id="scribble-racket-lang-org">
  <div class="tocset">
   <div class="tocview">
    <div class="tocviewlist tocviewlisttopspace">
     <div class="tocviewtitle">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td style="width: 1em;">
          <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">►</a>
         </td>
         <td></td>
         <td>
          <a href="index.html" class="tocviewlink" data-pltdoc="x">Logic &amp; Computation</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <div class="tocviewsublisttop" style="display: none;" id="tocview_0">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="lectures.html" class="tocviewselflink" data-pltdoc="x">Lectures</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="homework.html" class="tocviewlink" data-pltdoc="x">Homework</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="ref.html" class="tocviewlink" data-pltdoc="x">Lean Tactic Reference</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">▼</a>
        </td>
        <td></td>
        <td>
         <a href="lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublist" style="display: block;" id="tocview_1">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l1.html" class="tocviewlink" data-pltdoc="x">Lecture 1:<span class="mywbr"> &nbsp;</span> Intro</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l2.html" class="tocviewlink" data-pltdoc="x">Lecture 2:<span class="mywbr"> &nbsp;</span> Logistics, Specifications in ISL</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l3.html" class="tocviewlink" data-pltdoc="x">Lecture 3:<span class="mywbr"> &nbsp;</span> Propositional Logic in Code</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l4.html" class="tocviewlink" data-pltdoc="x">Lecture 4:<span class="mywbr"> &nbsp;</span> Design /<span class="mywbr"> &nbsp;</span> Specification Recipe</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l5.html" class="tocviewlink" data-pltdoc="x">Lecture 5:<span class="mywbr"> &nbsp;</span> Relational Specifications</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l6.html" class="tocviewlink" data-pltdoc="x">Lecture 6:<span class="mywbr"> &nbsp;</span> For-<wbr>all, Intro to PBT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l7.html" class="tocviewlink" data-pltdoc="x">Lecture 7:<span class="mywbr"> &nbsp;</span> ==&gt;, PBT filtering</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l8.html" class="tocviewlink" data-pltdoc="x">Lecture 8:<span class="mywbr"> &nbsp;</span> PBT generators</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l9.html" class="tocviewlink" data-pltdoc="x">Lecture 9:<span class="mywbr"> &nbsp;</span> SAT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l10.html" class="tocviewlink" data-pltdoc="x">Lecture 10:<span class="mywbr"> &nbsp;</span> SMT &amp; Rosette</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l11.html" class="tocviewlink" data-pltdoc="x">Lecture 11:<span class="mywbr"> &nbsp;</span> Rosette &amp; Finitization</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l12.html" class="tocviewlink" data-pltdoc="x">Lecture 12:<span class="mywbr"> &nbsp;</span> Higher order logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l13.html" class="tocviewlink" data-pltdoc="x">Lecture 13:<span class="mywbr"> &nbsp;</span> Functions</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l14.html" class="tocviewlink" data-pltdoc="x">Lecture 14:<span class="mywbr"> &nbsp;</span> Propositional logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l15.html" class="tocviewlink" data-pltdoc="x">Lecture 15:<span class="mywbr"> &nbsp;</span> Propositional logic &amp; programming</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l16.html" class="tocviewlink" data-pltdoc="x">Lecture 16:<span class="mywbr"> &nbsp;</span> Exam 1, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l17.html" class="tocviewlink" data-pltdoc="x">Lecture 17:<span class="mywbr"> &nbsp;</span> Exam 1, Part B</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l18.html" class="tocviewlink" data-pltdoc="x">Lecture 18:<span class="mywbr"> &nbsp;</span> Proving with tactics</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l19.html" class="tocviewlink" data-pltdoc="x">Lecture 19:<span class="mywbr"> &nbsp;</span> Inductive types &amp; proofs</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l20.html" class="tocviewlink" data-pltdoc="x">Lecture 20:<span class="mywbr"> &nbsp;</span> Lists</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l21.html" class="tocviewlink" data-pltdoc="x">Lecture 21:<span class="mywbr"> &nbsp;</span>  Proof Practice</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l22.html" class="tocviewlink" data-pltdoc="x">Lecture 22:<span class="mywbr"> &nbsp;</span> Generalizing hypotheses</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l23.html" class="tocviewlink" data-pltdoc="x">Lecture 23:<span class="mywbr"> &nbsp;</span> Generalize</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l24.html" class="tocviewlink" data-pltdoc="x">Lecture 24:<span class="mywbr"> &nbsp;</span> Standard Libraries</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l25.html" class="tocviewlink" data-pltdoc="x">Lecture 25:<span class="mywbr"> &nbsp;</span> Forward Reasoning</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 26:<span class="mywbr"> &nbsp;</span> Proof Automation</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l27.html" class="tocviewlink" data-pltdoc="x">Lecture 27:<span class="mywbr"> &nbsp;</span> Compiler Correctness</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l28.html" class="tocviewlink" data-pltdoc="x">Lecture 28:<span class="mywbr"> &nbsp;</span> Induction</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l29.html" class="tocviewlink" data-pltdoc="x">Lecture 29:<span class="mywbr"> &nbsp;</span> Functions vs. Relations</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l30.html" class="tocviewlink" data-pltdoc="x">Lecture 30:<span class="mywbr"> &nbsp;</span> Why logic?</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l31.html" class="tocviewlink" data-pltdoc="x">Lecture 31:<span class="mywbr"> &nbsp;</span> Linear Logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l32.html" class="tocviewlink" data-pltdoc="x">Lecture 32</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l33.html" class="tocviewlink" data-pltdoc="x">Lecture 33</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l34.html" class="tocviewlink" data-pltdoc="x">Lecture 34</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l35.html" class="tocviewlink" data-pltdoc="x">Lecture 35:<span class="mywbr"> &nbsp;</span> Exam 2, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l36.html" class="tocviewlink" data-pltdoc="x">Lecture 36:<span class="mywbr"> &nbsp;</span> Exam 2, Part B</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l37.html" class="tocviewlink" data-pltdoc="x">Lecture 37</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l38.html" class="tocviewlink" data-pltdoc="x">Lecture 38</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">►</a>
        </td>
        <td></td>
        <td>
         <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 26:<span class="mywbr"> &nbsp;</span> Proof Automation</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublistbottom" style="display: none;" id="tocview_2">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right">
          1&nbsp;
         </td>
         <td>
          <a href="#%28part._.Purpose%29" class="tocviewlink" data-pltdoc="x">Purpose</a>
         </td>
        </tr>
        <tr>
         <td align="right">
          2&nbsp;
         </td>
         <td>
          <a href="#%28part._.Outline%29" class="tocviewlink" data-pltdoc="x">Outline</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div>
   <div class="tocsub">
    <div class="tocsubtitle">
     On this page:
    </div>
    <table class="tocsublist" cellspacing="0">
     <tbody>
      <tr>
       <td>
        <span class="tocsublinknumber">1
        <tt>
         &nbsp;
        </tt>
       </span>
       <a href="#%28part._.Purpose%29" class="tocsubseclink" data-pltdoc="x">Purpose</a>
      </td>
     </tr>
     <tr>
      <td>
       <span class="tocsublinknumber">2
       <tt>
        &nbsp;
       </tt>
      </span>
      <a href="#%28part._.Outline%29" class="tocsubseclink" data-pltdoc="x">Outline</a>
     </td>
    </tr>
   </tbody>
  </table>
 </div>
</div>
<div class="maincolumn">
 <div class="main">
  <div class="versionbox">
   <span class="version">8.7</span>
  </div>
  <div class="navsettop">
   <span class="navleft">
   <div class="nosearchform"></div>
   &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
  </span>
  <span class="navright">&nbsp;&nbsp;<a href="l25.html" title="backward to &quot;Lecture 25: Forward Reasoning&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l27.html" title="forward to &quot;Lecture 27: Compiler Correctness&quot;" data-pltdoc="x">next →</a></span>&nbsp;
 </div>
 <h4>
  <a name="(part._l26)"></a>Lecture 26: Proof Automation
 </h4>
 <h5>
  1
  <tt>
   &nbsp;
  </tt>
  <a name="(part._.Purpose)"></a>Purpose
 </h5>
 <p>
  Learn how to use <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> to automate proofs.
 </p>
 <h5>
  2
  <tt>
   &nbsp;
  </tt>
  <a name="(part._.Outline)"></a>Outline
 </h5>
 <p>
  Up until now, we’ve used the tactic <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">function</span><span class="o">]</span></code></span> to run particular functions. But <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> is actually a much more general tactic, which we have intentionally avoided using because using too much automation early can make it hard to learn how to actually construct proofs, and there will always be cases where the automation fails, so it is important to understand how to do things "by hand". But, we’re now at the point where doing things step-by-step may be getting tedious, and avoiding some of that is possible with simp.
 </p>
 <p>
  At it’s core, <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> does two things: it rewrites with known equalities, and it also can try to prove hypotheses that arise from using theorems (which are equalities or not). Our <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Nat.add</span><span class="o">]</span></code></span> usage makes it rewrite with only the set of equalities that come from <span class="default"><code class="highlight-inline"><span class="n">Nat.add</span></code></span>. It will keep going until it cannot find any matching cases; this is why it corresponds to "running the function until it gets stuck". i.e., <span class="default"><code class="highlight-inline"><span class="n">Nat.add</span></code></span> really is two equations:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="n">a</span><span class="o">,</span> <span class="n">Nat.zero</span>   <span class="bp">=</span> <span class="n">a</span>
<span class="n">a</span><span class="o">,</span> <span class="n">Nat.succ</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">Nat.succ</span> <span class="o">(</span><span class="n">Nat.add</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
</pre>
  </div>
 </div>
 <p>
  And <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Nat.add</span><span class="o">]</span></code></span> will rewrite, from left to right, those two equations, as many times as it can, matching a and b with whatever it can.
 </p>
 <p>
  But there are other uses of simp. First, in a limited way, it can handle implications, provided it can find (among other theorems it is given) the hypotheses. For example:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">theorem</span> <span class="n">T</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">,</span> 
  <span class="o">(</span><span class="n">P</span> <span class="bp">-&gt;</span> <span class="n">Q</span> <span class="bp">-&gt;</span> <span class="n">R</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="o">(</span><span class="n">P</span> <span class="bp">-&gt;</span> <span class="n">Q</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="o">(</span><span class="n">Q</span> <span class="bp">-&gt;</span> <span class="n">R</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="n">P</span> <span class="bp">-&gt;</span> <span class="n">R</span> <span class="o">:=</span>
 <span class="kd">by</span> <span class="n">intros</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">H1</span> <span class="n">H2</span> <span class="n">H3</span> <span class="n">H4</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">H1</span><span class="o">,</span> <span class="n">H2</span><span class="o">,</span> <span class="n">H3</span><span class="o">,</span> <span class="n">H4</span><span class="o">]</span>
</pre>
  </div>
 </div>
 <p>
  Here, we are giving it not functions to rewrite with, but theorems (local ones, i.e., hypotheses) that it can use. It ends up applying a combination and using others to complete the goal. Note that if we leave some out, it won’t change the goal: while when rewriting with equations, it will do anything that makes progress, when it is using theorems that are implications, it will only apply them if it can prove the hypotheses. Note that this only works when the implications are of type <span class="default"><code class="highlight-inline"><span class="kt">Prop</span></code></span>.
 </p>
 <p>
  As a shorthand to listing all of the local hypotheses, we can write <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span></code></span> to mean, all of the local hypotheses.
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">theorem</span> <span class="n">T1</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">,</span> 
  <span class="o">(</span><span class="n">P</span> <span class="bp">-&gt;</span> <span class="n">Q</span> <span class="bp">-&gt;</span> <span class="n">R</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="o">(</span><span class="n">P</span> <span class="bp">-&gt;</span> <span class="n">Q</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="n">P</span> <span class="bp">-&gt;</span> <span class="n">R</span> <span class="o">:=</span>
 <span class="kd">by</span> <span class="n">intros</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>
</pre>
  </div>
 </div>
 <p>
  This is convenient not only to save typing on the line with <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span>, but in the case where we don’t need to refer to the hypotheses elsewhere, we can use intros with no arguments to get anonymous names (which <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> can handle just fine).
 </p>
 <p>
  But here we are still using <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> only. Why only? Well, it turns out that many theorems in the standard library have been marked as potential equations that simp could use, and you can mark your own. If you run <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span>, or <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span></code></span>, this will use all of those marked ones as well as any local ones:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">example</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span><span class="o">)</span>
        <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">∨</span> <span class="n">q</span> <span class="bp">∨</span> <span class="n">r</span><span class="o">)</span> <span class="bp">∧</span> <span class="o">(</span><span class="n">q</span> <span class="bp">∨</span> <span class="n">p</span> <span class="bp">∨</span> <span class="n">r</span><span class="o">)</span> <span class="bp">∧</span> <span class="o">(</span><span class="n">q</span> <span class="bp">∨</span> <span class="n">r</span> <span class="bp">∨</span> <span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>
</pre>
  </div>
 </div>
 <p>
  In this case, we rely on built-in theorems that deal with conjunctions and disjunctions. If we did this with <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span></code></span>, it would not be able to prove the goal (it would make some progress: since we have a proof of <span class="default"><code class="highlight-inline"><span class="n">p</span></code></span>, it would rewrite <span class="default"><code class="highlight-inline"><span class="n">p</span></code></span> with <span class="default"><code class="highlight-inline"><span class="n">True</span></code></span>, but then it would get stuck on the rest of the proof).
 </p>
 <p>
  You can add your own theorems (or definitions) to the set that is used globally by <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> by writing:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">def</span> <span class="n">double</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="n">Nat</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">Nat.succ</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="o">(</span><span class="n">double</span> <span class="n">x</span><span class="o">))</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">double</span>
</pre>
  </div>
 </div>
 <p>
  There is also a shorthand to add the attribute when you are defining the theorem (or function):
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">@[simp]</span> <span class="kd">theorem</span> <span class="n">double_succ</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">double</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">double</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">2</span> <span class="o">:=</span>
 <span class="kd">by</span> <span class="gr">sorry</span>
</pre>
  </div>
 </div>
 <p>
  For example: now writing <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span> or <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span></code></span> will rewrite with the <span class="default"><code class="highlight-inline"><span class="n">double</span></code></span> function, and the <span class="default"><code class="highlight-inline"><span class="n">double_succ</span></code></span> theorem. However, adding global definitions can be a bit fragile, and it may be easier to understand proofs if you add them locally, so you can include both all hypotheses and specific additional theorems as follows:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">def</span> <span class="n">even</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">-&gt;</span> <span class="n">Bool</span> 
<span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="n">true</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="bp">=&gt;</span> <span class="n">false</span>
<span class="bp">|</span> <span class="n">Nat.succ</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">even</span> <span class="n">n</span>

<span class="kd">theorem</span> <span class="n">even_double</span><span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">,</span> <span class="n">even</span> <span class="o">(</span><span class="n">double</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">true</span> <span class="o">:=</span> 
 <span class="kd">by</span> <span class="n">intros</span> <span class="n">x</span>
    <span class="n">induction</span> <span class="n">x</span> <span class="bp">&lt;;&gt;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">double</span><span class="o">,</span> <span class="n">even</span><span class="o">]</span>

<span class="kd">theorem</span> <span class="n">mult_2_x</span><span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">,</span> <span class="n">Nat.mul</span> <span class="mi">2</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">Nat.add</span> <span class="n">x</span> <span class="n">x</span> <span class="o">:=</span> 
 <span class="kd">by</span> <span class="n">intros</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">Nat.succ_mul</span><span class="o">]</span>
</pre>
  </div>
 </div>
 <p>
  Note, here, how we prove two theorems from HW7 primarily by appeal to simp. Note two limitations: first, it will not introduce hypotheses: but if we are going to do a proof entirely with simp, we don’t need names for the hypotheses, so using intros is fine. Second, and more importantly, simp will never do induction on a hypothesis, and will only do case analysis on certain built-in types (e.g., it will break a conjunction <span class="default"><code class="highlight-inline"><span class="n">P</span> <span class="bp">/\</span> <span class="n">Q</span></code></span> into two): it will not, e.g., do case analysis on any types you have defined, unless you create theorems specifically for that purpose and mark them as simp theorems.
 </p>
 <p>
  The reason for not automatically trying induction is a bit more fundamental: automatically figuring out what to do induction on is a really hard problem, and while it may be possible in certain cases, it is not in general. It is one of the things that you will need to do manually: indeed, figuring out what to do induction on is often one of the key parts of a proof; after that, the rest is sometimes somewhat mechanical, and reducing the effort of mechanical steps is what simp can help with.
 </p>
 <p>
  A related thing it won’t do is generalize parts of the goal (since we often do that in order to do case analysis, it’s not clear how invoking generalize would help simp, but it won’t do it).
 </p>
 <p>
  Now that we have some sense of how it works, let’s practice by redoing two proofs that we did previously in lecture, this time using <span class="default"><code class="highlight-inline"><span class="n">simp</span></code></span>.
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="kd">inductive</span> <span class="n">ev'</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span>
  <span class="bp">|</span> <span class="n">O</span> <span class="o">:</span> <span class="n">ev'</span> <span class="mi">0</span>
  <span class="bp">|</span> <span class="n">SSO</span> <span class="o">:</span> <span class="n">ev'</span> <span class="mi">2</span>
  <span class="bp">|</span> <span class="n">sum</span> <span class="n">n</span> <span class="n">m</span> <span class="o">(</span><span class="n">Hn</span> <span class="o">:</span> <span class="n">ev'</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">Hm</span> <span class="o">:</span> <span class="n">ev'</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span> <span class="n">ev'</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">twice_n_ev'</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span><span class="o">,</span> <span class="n">ev'</span> <span class="o">(</span><span class="n">n</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span>
 <span class="kd">by</span> <span class="n">intros</span> <span class="n">n</span><span class="bp">;</span> <span class="n">induction</span> <span class="n">n</span> <span class="bp">&lt;;&gt;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">ev'.O</span><span class="o">,</span> <span class="n">ev'.SSO</span><span class="o">,</span> <span class="n">ev'.sum</span><span class="o">,</span> <span class="n">Nat.succ_mul</span><span class="o">]</span>

<span class="kd">inductive</span> <span class="n">ev</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">-&gt;</span> <span class="kt">Prop</span> 
<span class="bp">|</span> <span class="n">O</span> <span class="o">:</span> <span class="n">ev</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="n">SS</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">ev</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">ev</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="n">n</span><span class="o">))</span>

<span class="kd">theorem</span> <span class="n">ev_ev__ev</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span> <span class="n">m</span><span class="o">,</span> <span class="n">ev</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="n">ev</span> <span class="n">n</span> <span class="bp">-&gt;</span> <span class="n">ev</span> <span class="n">m</span> <span class="o">:=</span>  
 <span class="kd">by</span> <span class="n">intros</span> <span class="n">n</span> <span class="n">m</span> <span class="n">H1</span> <span class="n">H2</span>
    <span class="n">induction</span> <span class="n">H2</span> <span class="bp">&lt;;&gt;</span> 
    <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">Nat.succ_add</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span> <span class="bp">&lt;;&gt;</span> 
    <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>
    <span class="n">cases</span> <span class="n">H1</span>
    <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>

<span class="c1">-- alternatively:</span>

<span class="kd">theorem</span> <span class="n">succ_succ_ev</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span><span class="o">,</span> <span class="n">ev</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="o">(</span><span class="n">Nat.succ</span> <span class="n">n</span><span class="o">))</span> <span class="bp">&lt;-&gt;</span> <span class="n">ev</span> <span class="n">n</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">intros</span> <span class="n">n</span><span class="bp">;</span> <span class="n">constructor</span>
     <span class="bp">.</span> <span class="n">intro</span> <span class="n">H</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">H</span><span class="bp">;</span> <span class="n">assumption</span>
     <span class="bp">.</span> <span class="n">intros</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">assumption</span>


<span class="kd">theorem</span> <span class="n">ev_ev__ev_alt</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span> <span class="n">m</span><span class="o">,</span> <span class="n">ev</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="n">ev</span> <span class="n">n</span> <span class="bp">-&gt;</span> <span class="n">ev</span> <span class="n">m</span> <span class="o">:=</span>  
 <span class="kd">by</span> <span class="n">intros</span> <span class="n">n</span> <span class="n">m</span> <span class="n">H1</span> <span class="n">H2</span>
    <span class="n">induction</span> <span class="n">H2</span> <span class="bp">&lt;;&gt;</span> 
    <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">Nat.succ_add</span><span class="o">,</span> <span class="n">succ_succ_ev</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span> <span class="bp">&lt;;&gt;</span> 
    <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>
</pre>
  </div>
 </div>
 <p></p>
 <table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;">
  <tbody>
   <tr>
    <td style="border-bottom: 1px solid black;">
     <p>
      <span style="font-weight: bold">Tactic Use</span>
     </p>
    </td>
    <td style="border-bottom: 1px solid black;">
     <p>
      <span style="font-weight: bold">Tactic Description</span>
     </p>
    </td>
   </tr>
   <tr>
    <td style="border-bottom: 1px solid black;">
     <p>
      <span class="default"><code class="highlight-inline"><span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span></code></span>
     </p>
    </td>
    <td style="border-bottom: 1px solid black;">
     <p>
      Try to rewrite with any of the built-in simp theorems, any of the local hypotheses (*), or any of the theorems h1 and h2. You can also do this with <span class="default"><code class="highlight-inline"><span class="n">only</span></code></span> to avoid the built-in simp theorems.
     </p>
    </td>
   </tr>
  </tbody>
 </table>
 <p></p>
 <div class="navsetbottom">
  <span class="navleft">
  <div class="nosearchform"></div>
  &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
 </span>
 <span class="navright">&nbsp;&nbsp;<a href="l25.html" title="backward to &quot;Lecture 25: Forward Reasoning&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l27.html" title="forward to &quot;Lecture 27: Compiler Correctness&quot;" data-pltdoc="x">next →</a></span>&nbsp;
</div>
</div>
</div>
<div id="contextindicator">
&nbsp;
</div>
</body>
</html>
