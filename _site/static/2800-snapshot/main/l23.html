<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <title>
   dbp.io
  </title>
  <link rel="stylesheet" type="text/css" href="scribble.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-racket.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted-default-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="main.css" title="default">
  <script type="text/javascript" src="scribble-common.js"></script>
  <script type="text/javascript" src="manual-racket.js"></script>
 </head>
 <body id="scribble-racket-lang-org">
  <div class="tocset">
   <div class="tocview">
    <div class="tocviewlist tocviewlisttopspace">
     <div class="tocviewtitle">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td style="width: 1em;">
          <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">►</a>
         </td>
         <td></td>
         <td>
          <a href="index.html" class="tocviewlink" data-pltdoc="x">Logic &amp; Computation</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <div class="tocviewsublisttop" style="display: none;" id="tocview_0">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="lectures.html" class="tocviewselflink" data-pltdoc="x">Lectures</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="homework.html" class="tocviewlink" data-pltdoc="x">Homework</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">▼</a>
        </td>
        <td></td>
        <td>
         <a href="lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublist" style="display: block;" id="tocview_1">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l1.html" class="tocviewlink" data-pltdoc="x">Lecture 1:<span class="mywbr"> &nbsp;</span> Intro</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l2.html" class="tocviewlink" data-pltdoc="x">Lecture 2:<span class="mywbr"> &nbsp;</span> Logistics, Specifications in ISL</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l3.html" class="tocviewlink" data-pltdoc="x">Lecture 3:<span class="mywbr"> &nbsp;</span> Propositional Logic in Code</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l4.html" class="tocviewlink" data-pltdoc="x">Lecture 4:<span class="mywbr"> &nbsp;</span> Design /<span class="mywbr"> &nbsp;</span> Specification Recipe</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l5.html" class="tocviewlink" data-pltdoc="x">Lecture 5:<span class="mywbr"> &nbsp;</span> Relational Specifications</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l6.html" class="tocviewlink" data-pltdoc="x">Lecture 6:<span class="mywbr"> &nbsp;</span> For-<wbr>all, Intro to PBT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l7.html" class="tocviewlink" data-pltdoc="x">Lecture 7:<span class="mywbr"> &nbsp;</span> ==&gt;, PBT filtering</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l8.html" class="tocviewlink" data-pltdoc="x">Lecture 8:<span class="mywbr"> &nbsp;</span> PBT generators</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l9.html" class="tocviewlink" data-pltdoc="x">Lecture 9:<span class="mywbr"> &nbsp;</span> SAT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l10.html" class="tocviewlink" data-pltdoc="x">Lecture 10:<span class="mywbr"> &nbsp;</span> SMT &amp; Rosette</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l11.html" class="tocviewlink" data-pltdoc="x">Lecture 11:<span class="mywbr"> &nbsp;</span> Rosette &amp; Finitization</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l12.html" class="tocviewlink" data-pltdoc="x">Lecture 12:<span class="mywbr"> &nbsp;</span> Higher order logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l13.html" class="tocviewlink" data-pltdoc="x">Lecture 13:<span class="mywbr"> &nbsp;</span> Functions</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l14.html" class="tocviewlink" data-pltdoc="x">Lecture 14:<span class="mywbr"> &nbsp;</span> Propositional logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l15.html" class="tocviewlink" data-pltdoc="x">Lecture 15:<span class="mywbr"> &nbsp;</span> Propositional logic &amp; programming</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l16.html" class="tocviewlink" data-pltdoc="x">Lecture 16:<span class="mywbr"> &nbsp;</span> Exam 1, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l17.html" class="tocviewlink" data-pltdoc="x">Lecture 17:<span class="mywbr"> &nbsp;</span> Exam 1, Part B</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l18.html" class="tocviewlink" data-pltdoc="x">Lecture 18:<span class="mywbr"> &nbsp;</span> Proving with tactics</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l19.html" class="tocviewlink" data-pltdoc="x">Lecture 19:<span class="mywbr"> &nbsp;</span> Inductive types &amp; proofs</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l20.html" class="tocviewlink" data-pltdoc="x">Lecture 20:<span class="mywbr"> &nbsp;</span> Lists</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l21.html" class="tocviewlink" data-pltdoc="x">Lecture 21:<span class="mywbr"> &nbsp;</span> Proof Practice</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l22.html" class="tocviewlink" data-pltdoc="x">Lecture 22:<span class="mywbr"> &nbsp;</span> Generalizing hypotheses</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 23:<span class="mywbr"> &nbsp;</span> Trees</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l35.html" class="tocviewlink" data-pltdoc="x">Lecture 35:<span class="mywbr"> &nbsp;</span> Exam 2, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l36.html" class="tocviewlink" data-pltdoc="x">Lecture 36:<span class="mywbr"> &nbsp;</span> Exam 2, Part B</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">►</a>
        </td>
        <td></td>
        <td>
         <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 23:<span class="mywbr"> &nbsp;</span> Trees</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublistbottom" style="display: none;" id="tocview_2">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right">
          1&nbsp;
         </td>
         <td>
          <a href="#%28part._.Purpose%29" class="tocviewlink" data-pltdoc="x">Purpose</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div>
   <div class="tocsub">
    <div class="tocsubtitle">
     On this page:
    </div>
    <table class="tocsublist" cellspacing="0">
     <tbody>
      <tr>
       <td>
        <span class="tocsublinknumber">1
        <tt>
         &nbsp;
        </tt>
       </span>
       <a href="#%28part._.Purpose%29" class="tocsubseclink" data-pltdoc="x">Purpose</a>
      </td>
     </tr>
    </tbody>
   </table>
  </div>
 </div>
 <div class="maincolumn">
  <div class="main">
   <div class="versionbox">
    <span class="version">8.7</span>
   </div>
   <div class="navsettop">
    <span class="navleft">
    <div class="nosearchform"></div>
    &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
   </span>
   <span class="navright">&nbsp;&nbsp;<a href="l22.html" title="backward to &quot;Lecture 22: Generalizing hypotheses&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l35.html" title="forward to &quot;Lecture 35: Exam 2, Part A&quot;" data-pltdoc="x">next →</a></span>&nbsp;
  </div>
  <h4>
   <a name="(part._l23)"></a>Lecture 23: Trees
  </h4>
  <h5>
   1
   <tt>
    &nbsp;
   </tt>
   <a name="(part._.Purpose)"></a>Purpose
  </h5>
  <p>
   Practice proofs with trees.
  </p>
  <p>
   One of the most ubiquitous data structures throughout computer science
is the tree, and the most common variant is a binary tree. We can
represent the simplest version, a binary tree with natural numbers on
the leaves, as:
  </p>
  <div class="default">
   <div class="highlight">
    <pre><span></span><span class="kd">inductive</span> <span class="n">ntree</span> <span class="o">:=</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">node</span> <span class="o">(</span><span class="n">l</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span>
</pre>
   </div>
  </div>
  <p>
   On their own, trees can be useful to describe certain types of data,
but where they shine is when used within algorithms, and in particular,
when particular invariants are mantained about the tree. One such
invariant is that the tree is <span style="font-style: italic">ordered</span>, which means that for
any node, all the values on the left subtree are less than all the
values on the right subtree.
  </p>
  <p>
   We can represent this property in three different ways in Lean:
  </p>
  <div class="default">
   <div class="highlight">
    <pre><span></span><span class="kd">def</span> <span class="n">ntree.max</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="n">Nat</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">Nat.max</span> <span class="n">l.max</span> <span class="n">r.max</span>

<span class="kd">def</span> <span class="n">ntree.min</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="n">Nat</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">Nat.min</span> <span class="n">l.min</span> <span class="n">r.min</span>

<span class="kd">def</span> <span class="n">ntree.ordered</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="n">Bool</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">true</span>
<span class="bp">|</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">ntree.ordered</span> <span class="n">l</span> <span class="bp">&amp;&amp;</span> <span class="n">ntree.ordered</span> <span class="n">r</span> <span class="bp">&amp;&amp;</span> <span class="n">Nat.blt</span> <span class="n">l.max</span> <span class="n">r.min</span>

<span class="kd">def</span> <span class="n">ntree.ordered'</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">True</span>
<span class="bp">|</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">ntree.ordered'</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">ntree.ordered'</span> <span class="n">r</span> <span class="bp">∧</span> <span class="n">l.max</span> <span class="bp">&lt;</span> <span class="n">r.min</span>

<span class="kd">inductive</span> <span class="n">ntree_max</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> <span class="n">ntree_max</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">)</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">node</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">l</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">nl</span> <span class="n">nr</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span>
                <span class="n">ntree_max</span> <span class="n">l</span> <span class="n">nl</span> <span class="bp">-&gt;</span> <span class="n">ntree_max</span> <span class="n">r</span> <span class="n">nr</span> <span class="bp">-&gt;</span>
                <span class="n">ntree_max</span> <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">Nat.max</span> <span class="n">nl</span> <span class="n">nr</span><span class="o">)</span>

<span class="kd">inductive</span> <span class="n">ntree_min</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> <span class="n">ntree_min</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">)</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">node</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">l</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">nl</span> <span class="n">nr</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span>
                <span class="n">ntree_min</span> <span class="n">l</span> <span class="n">nl</span> <span class="bp">-&gt;</span> <span class="n">ntree_min</span> <span class="n">r</span> <span class="n">nr</span> <span class="bp">-&gt;</span> 
                <span class="n">ntree_min</span> <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">Nat.min</span> <span class="n">nl</span> <span class="n">nr</span><span class="o">)</span>

<span class="kd">inductive</span> <span class="n">ntree_ordered</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> <span class="n">ntree_ordered</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">node</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">l</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">nl</span> <span class="n">nr</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
                <span class="n">ntree_ordered</span> <span class="n">l</span> <span class="bp">-&gt;</span> <span class="n">ntree_ordered</span> <span class="n">r</span> <span class="bp">-&gt;</span>
                <span class="n">ntree_max</span> <span class="n">l</span> <span class="n">nl</span> <span class="bp">-&gt;</span> <span class="n">ntree_min</span> <span class="n">r</span> <span class="n">nr</span> <span class="bp">-&gt;</span>
                <span class="n">nl</span> <span class="bp">&lt;=</span> <span class="n">nr</span> <span class="bp">-&gt;</span> <span class="n">ntree_ordered</span> <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r</span><span class="o">)</span>
</pre>
   </div>
  </div>
  <p>
   First, we compute it directly, using a function that returns boolean
values: true if the tree is ordered, and false otherwise. Second, we
compute a proposition, True if it is ordered, and False otherwise.
These definitions look really similar, but the first can be run,
whereas the second cannot be. Third, we define an inductive type that
describes what it means to be ordered. This definition probably seems
like the clumsiest, and it certainly is more verbose, but it has
an advantage over the other two, which is that the <span style="font-style: italic">steps</span> to
show that the tree is ordered are <span style="font-style: italic">data</span>, which means when it
comes time to prove things about the definition, this last definition
is most likely going to be the most useful. In particular, we can
carry out proofs based on the structure of the ordering, rather than
simply the structure of the tree, which may end up being much more
useful.
  </p>
  <p>
   Let’s try to prove that an <span class="default"><code class="highlight-inline"><span class="n">insert</span></code></span> function mantains ordering.
We’ll do this three times, for each of the three definitions of
ordered.
  </p>
  <div class="default">
   <div class="highlight">
    <pre><span></span><span class="kd">def</span> <span class="n">ntree.insert</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">→</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="n">ntree</span>
<span class="bp">|</span> <span class="n">leaf</span> <span class="n">n</span><span class="o">,</span> <span class="n">m</span> <span class="bp">=&gt;</span> 
  <span class="k">if</span> <span class="n">Nat.ble</span> <span class="n">n</span> <span class="n">m</span> 
  <span class="k">then</span> <span class="n">ntree.node</span> <span class="o">(</span><span class="n">leaf</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">leaf</span> <span class="n">m</span><span class="o">)</span> 
  <span class="k">else</span> <span class="n">ntree.node</span> <span class="o">(</span><span class="n">leaf</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">leaf</span> <span class="n">n</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span><span class="o">,</span> <span class="n">m</span> <span class="bp">=&gt;</span> 
  <span class="k">if</span> <span class="n">Nat.ble</span> <span class="n">l.max</span> <span class="n">m</span> 
  <span class="k">then</span> <span class="n">ntree.node</span> <span class="n">l</span> <span class="o">(</span><span class="n">r.insert</span> <span class="n">m</span><span class="o">)</span> 
  <span class="k">else</span> <span class="n">ntree.node</span> <span class="o">(</span><span class="n">l.insert</span> <span class="n">m</span><span class="o">)</span> <span class="n">r</span>

<span class="kd">inductive</span> <span class="n">ntree_insert</span> <span class="o">:</span> <span class="n">ntree</span> <span class="bp">-&gt;</span> <span class="n">Nat</span> <span class="bp">-&gt;</span> <span class="n">ntree</span> <span class="bp">-&gt;</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">|</span> <span class="n">leaf_right</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span> <span class="n">m</span><span class="o">,</span> <span class="n">Nat.le</span> <span class="n">n</span> <span class="n">m</span> <span class="bp">-&gt;</span> 
    <span class="n">ntree_insert</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">)</span> 
                 <span class="n">m</span> 
                 <span class="o">(</span><span class="n">ntree.node</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">)</span> 
                             <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">m</span><span class="o">))</span>
<span class="bp">|</span> <span class="n">leaf_left</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span> <span class="n">m</span><span class="o">,</span> <span class="bp">¬</span><span class="o">(</span><span class="n">Nat.le</span> <span class="n">n</span> <span class="n">m</span><span class="o">)</span> <span class="bp">-&gt;</span>
    <span class="n">ntree_insert</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">)</span> 
                 <span class="n">m</span> 
                 <span class="o">(</span><span class="n">ntree.node</span> <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">m</span><span class="o">)</span> 
                             <span class="o">(</span><span class="n">ntree.leaf</span> <span class="n">n</span><span class="o">))</span>
<span class="bp">|</span> <span class="n">node_right</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">l</span> <span class="n">r</span> <span class="n">lmax</span> <span class="n">r'</span> <span class="n">m</span><span class="o">,</span> 
    <span class="n">ntree_max</span> <span class="n">l</span> <span class="n">lmax</span> <span class="bp">-&gt;</span> 
    <span class="n">Nat.le</span> <span class="n">lmax</span> <span class="n">m</span> <span class="bp">-&gt;</span>
    <span class="n">ntree_insert</span> <span class="n">r</span> <span class="n">m</span> <span class="n">r'</span> <span class="bp">-&gt;</span>
    <span class="n">ntree_insert</span> <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r</span><span class="o">)</span>
                 <span class="n">m</span>
                 <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r'</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">node_left</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">l</span> <span class="n">r</span> <span class="n">lmax</span> <span class="n">l'</span> <span class="n">m</span><span class="o">,</span> 
    <span class="n">ntree_max</span> <span class="n">l</span> <span class="n">lmax</span> <span class="bp">-&gt;</span> 
    <span class="bp">¬</span> <span class="o">(</span><span class="n">Nat.le</span> <span class="n">lmax</span> <span class="n">m</span><span class="o">)</span> <span class="bp">-&gt;</span>
    <span class="n">ntree_insert</span> <span class="n">l</span> <span class="n">m</span> <span class="n">l'</span> <span class="bp">-&gt;</span>
    <span class="n">ntree_insert</span> <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r</span><span class="o">)</span>
                 <span class="n">m</span>
                 <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l'</span> <span class="n">r</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">ntree_ordered_insert1</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="n">t'</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
  <span class="n">ntree_ordered</span> <span class="n">t</span> <span class="bp">-&gt;</span> <span class="n">ntree_insert</span> <span class="n">t</span> <span class="n">n</span> <span class="n">t'</span> <span class="bp">-&gt;</span> <span class="n">ntree_ordered</span> <span class="n">t'</span> <span class="o">:=</span>
 <span class="kd">by</span> <span class="n">intro</span> <span class="n">t</span>
    <span class="n">induction</span> <span class="n">t</span>
    <span class="n">case</span> <span class="n">leaf</span> <span class="n">n</span> <span class="bp">=&gt;</span> 
      <span class="n">intros</span> <span class="n">t'</span> <span class="n">n1</span> <span class="n">H1</span> <span class="n">H2</span>
      <span class="n">cases</span> <span class="n">H1</span>
      <span class="n">cases</span> <span class="n">H2</span>
      <span class="n">case</span> <span class="n">leaf.leaf_right</span> <span class="n">H</span> <span class="bp">=&gt;</span>
        <span class="n">apply</span> <span class="n">ntree_ordered.node</span> <span class="bp">&lt;;&gt;</span> <span class="n">try</span> <span class="n">constructor</span>
        <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">LE.le</span><span class="o">]</span>
        <span class="n">assumption</span>
      <span class="n">case</span> <span class="n">leaf.leaf_left</span> <span class="n">H</span> <span class="bp">=&gt;</span>
        <span class="n">apply</span> <span class="n">ntree_ordered.node</span> <span class="bp">&lt;;&gt;</span> <span class="n">try</span> <span class="n">constructor</span>
        <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">LE.le</span><span class="o">]</span>
        <span class="n">cases</span> <span class="o">(</span><span class="n">Nat.le_total</span> <span class="n">n</span> <span class="n">n1</span><span class="o">)</span>
        <span class="n">case</span> <span class="n">a.inl</span> <span class="n">H'</span> <span class="bp">=&gt;</span>
          <span class="n">rw</span> <span class="o">[</span><span class="bp">&lt;-</span> <span class="n">Nat.le_eq</span><span class="o">]</span> <span class="n">at</span> <span class="n">H'</span>
          <span class="n">apply</span> <span class="n">False.elim</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">H</span><span class="bp">;</span> <span class="n">assumption</span>
        <span class="n">case</span> <span class="n">a.inr</span> <span class="n">H'</span> <span class="bp">=&gt;</span>
          <span class="n">rw</span> <span class="o">[</span><span class="bp">&lt;-</span> <span class="n">Nat.le_eq</span><span class="o">]</span> <span class="n">at</span> <span class="n">H'</span>
          <span class="n">assumption</span>
    <span class="n">case</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="n">H1</span> <span class="n">H2</span> <span class="bp">=&gt;</span>
      <span class="n">intros</span> <span class="n">t'</span> <span class="n">n</span> <span class="n">Ho</span> <span class="n">Hi</span>
      <span class="n">cases</span> <span class="n">Ho</span>
      <span class="n">case</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="n">nl</span> <span class="n">nr</span> <span class="n">lt</span> <span class="n">lo</span> <span class="n">lm</span> <span class="n">ro</span> <span class="n">rm</span> <span class="bp">=&gt;</span>
        <span class="n">cases</span> <span class="n">Hi</span>
        
        


<span class="kd">theorem</span> <span class="n">lt_inv</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">n</span> <span class="n">m</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> <span class="n">Nat.blt</span> <span class="n">n</span> <span class="n">m</span> <span class="bp">=</span> <span class="n">false</span> <span class="bp">-&gt;</span> <span class="n">Nat.blt</span> <span class="n">m</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">true</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">ntree_ordered_node</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">{</span><span class="n">l</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">},</span> 
  <span class="n">ntree.ordered</span> <span class="o">(</span><span class="n">ntree.node</span> <span class="n">l</span> <span class="n">r</span><span class="o">)</span> <span class="bp">=</span> <span class="n">true</span> <span class="bp">-&gt;</span> <span class="o">(</span><span class="n">ntree.ordered</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="bp">/\</span> <span class="o">(</span><span class="n">ntree.ordered</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">ntree_insert_max_helper</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">t</span> <span class="n">n</span><span class="o">,</span> 
  <span class="n">Nat.blt</span> <span class="o">(</span><span class="n">ntree.max</span> <span class="n">t</span><span class="o">)</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">false</span> <span class="bp">-&gt;</span> <span class="n">ntree.max</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">ntree_insert_min_helper</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="n">m</span> <span class="n">n</span><span class="o">,</span> 
  <span class="n">Nat.blt</span> <span class="n">m</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">true</span> <span class="bp">-&gt;</span> <span class="n">Nat.blt</span> <span class="n">m</span> <span class="o">(</span><span class="n">ntree.min</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n</span><span class="o">))</span> <span class="bp">=</span> <span class="n">true</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>
       

<span class="kd">theorem</span> <span class="n">ntree_ordered_insert1</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
  <span class="n">ntree.ordered</span> <span class="n">t</span> <span class="bp">-&gt;</span> <span class="n">ntree.ordered</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">intro</span> <span class="n">t</span>
     <span class="n">induction</span> <span class="n">t</span>
     <span class="n">case</span> <span class="n">leaf</span> <span class="n">n</span> <span class="bp">=&gt;</span> 
       <span class="n">intro</span> <span class="n">n'</span>
       <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.ordered</span><span class="o">,</span> <span class="n">ntree.insert</span><span class="o">]</span>
       <span class="n">intro</span> <span class="n">h'</span>
       <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Nat.blt</span> <span class="n">n</span> <span class="n">n'</span> <span class="bp">=</span> <span class="n">x</span>
       <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span> 
         <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.ordered</span><span class="o">,</span> <span class="n">ntree.max</span><span class="o">,</span> <span class="n">ntree.min</span><span class="o">]</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">lt_inv</span><span class="o">]</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
         <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.ordered</span><span class="o">,</span> <span class="n">ntree.max</span><span class="o">,</span> <span class="n">ntree.min</span><span class="o">]</span>
                   <span class="n">assumption</span>
     <span class="n">case</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="n">hl</span> <span class="n">hr</span> <span class="bp">=&gt;</span>
        <span class="n">intro</span> <span class="n">n'</span> <span class="n">h'</span>
        <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.ordered</span><span class="o">,</span> <span class="n">ntree.insert</span><span class="o">]</span>
        <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Nat.blt</span> <span class="n">l.max</span> <span class="n">n'</span> <span class="bp">=</span> <span class="n">x</span>
        <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span>
          <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.ordered</span><span class="o">,</span> <span class="n">ntree.max</span><span class="o">,</span> <span class="n">ntree.min</span><span class="o">]</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">hl</span><span class="o">]</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">Bool.true_and</span><span class="o">,</span> <span class="n">Bool.and_eq_true</span><span class="o">]</span>
                     <span class="n">constructor</span>
                     <span class="n">cases</span> <span class="o">(</span><span class="n">ntree_ordered_node</span> <span class="n">h'</span><span class="o">)</span><span class="bp">;</span> <span class="n">assumption</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">ntree_insert_max_helper</span><span class="o">]</span>
                     <span class="n">unfold</span> <span class="n">ntree.ordered</span> <span class="n">at</span> <span class="n">h'</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">Bool.and_eq_true</span><span class="o">]</span> <span class="n">at</span> <span class="n">h'</span>
                     <span class="n">cases</span> <span class="n">h'</span> <span class="k">with</span> <span class="bp">|</span> <span class="n">intro</span> <span class="n">h1</span> <span class="n">h2</span> <span class="bp">=&gt;</span> <span class="o">{</span>
                       <span class="n">simp</span>
                       <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="n">n'</span> <span class="bp">&lt;</span> <span class="n">ntree.max</span> <span class="n">l</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>
                       <span class="k">have</span> <span class="n">h4</span> <span class="o">:</span> <span class="n">ntree.max</span> <span class="n">l</span> <span class="bp">&lt;</span> <span class="n">ntree.min</span> <span class="n">r</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>
                       <span class="n">apply</span> <span class="n">Nat.lt_trans</span>
                       <span class="n">assumption</span>
                       <span class="n">assumption</span>
                     <span class="o">}</span>
                     <span class="n">unfold</span> <span class="n">ntree.ordered</span> <span class="n">at</span> <span class="n">h'</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">Bool.and_eq_true</span><span class="o">]</span> <span class="n">at</span> <span class="n">h'</span>
                     <span class="n">cases</span> <span class="n">h'</span> <span class="k">with</span> <span class="bp">|</span> <span class="n">intro</span> <span class="n">h1</span> <span class="n">h2</span> <span class="bp">=&gt;</span>
                       <span class="n">assumption</span>
                     <span class="n">cases</span> <span class="o">(</span><span class="n">ntree_ordered_node</span> <span class="n">h'</span><span class="o">)</span><span class="bp">;</span> <span class="n">assumption</span>
          <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.ordered</span><span class="o">,</span> <span class="n">ntree.max</span><span class="o">,</span> <span class="n">ntree.min</span><span class="o">]</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">hr</span><span class="o">]</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">Bool.and_true</span><span class="o">,</span> <span class="n">Bool.and_eq_true</span><span class="o">]</span>
                    <span class="n">constructor</span>
                    <span class="n">cases</span> <span class="o">(</span><span class="n">ntree_ordered_node</span> <span class="n">h'</span><span class="o">)</span><span class="bp">;</span> <span class="n">assumption</span>
                    <span class="n">apply</span> <span class="n">ntree_insert_min_helper</span>
                    <span class="n">assumption</span>
                    <span class="n">cases</span> <span class="o">(</span><span class="n">ntree_ordered_node</span> <span class="n">h'</span><span class="o">)</span><span class="bp">;</span> <span class="n">assumption</span>  
       
<span class="kd">theorem</span> <span class="n">ntree_ordered_insert2</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
  <span class="n">ntree.ordered'</span> <span class="n">t</span> <span class="bp">-&gt;</span> <span class="n">ntree.ordered'</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>


<span class="kd">theorem</span> <span class="n">ntree_min_helper</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="n">n'</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
  <span class="n">ntree_min</span> <span class="n">t</span> <span class="n">n</span> <span class="bp">-&gt;</span> <span class="n">ntree_min</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n'</span><span class="o">)</span> <span class="o">(</span><span class="n">Nat.min</span> <span class="n">n</span> <span class="n">n'</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">ntree_max_helper</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span>
  <span class="n">ntree_max</span> <span class="n">t</span> <span class="n">n</span> <span class="bp">-&gt;</span> <span class="n">ntree.max</span> <span class="n">t</span> <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">ntree_max_helper'</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span>
   <span class="n">ntree.max</span> <span class="n">t</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">-&gt;</span>  <span class="n">ntree_max</span> <span class="n">t</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">min_helper</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span> <span class="n">m</span> <span class="n">o</span><span class="o">,</span> <span class="n">n</span> <span class="bp">&lt;=</span> <span class="n">m</span> <span class="bp">-&gt;</span> <span class="n">n</span> <span class="bp">&lt;=</span> <span class="n">o</span> <span class="bp">-&gt;</span> <span class="n">n</span> <span class="bp">&lt;=</span> <span class="n">Nat.min</span> <span class="n">m</span> <span class="n">o</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">nat_blt_neq</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">n</span> <span class="n">m</span><span class="o">,</span> <span class="n">Nat.blt</span> <span class="n">n</span> <span class="n">m</span> <span class="bp">=</span> <span class="n">false</span> <span class="bp">-&gt;</span> <span class="n">m</span> <span class="bp">&lt;=</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>


<span class="kd">theorem</span> <span class="n">ntree_ordered_insert3</span> <span class="o">:</span> <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
  <span class="n">ntree_ordered</span> <span class="n">t</span> <span class="bp">-&gt;</span> <span class="n">ntree_ordered</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">intro</span> <span class="n">t</span>
     <span class="n">induction</span> <span class="n">t</span>
     <span class="n">case</span> <span class="n">leaf</span> <span class="n">n</span> <span class="bp">=&gt;</span> 
       <span class="n">intro</span> <span class="n">n'</span> <span class="n">h'</span> 
       <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.insert</span><span class="o">]</span>
       <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Nat.blt</span> <span class="n">n</span> <span class="n">n'</span> <span class="bp">=</span> <span class="n">x</span>
       <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span>
       <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> 
         <span class="n">simp</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.blt_eq</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Nat.le_of_lt</span><span class="bp">;</span> <span class="n">assumption</span>
       <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">simp</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">nat_blt_neq</span><span class="bp">;</span> <span class="n">assumption</span>
     <span class="n">case</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="n">hl</span> <span class="n">hr</span> <span class="bp">=&gt;</span>
       <span class="n">intro</span> <span class="n">n'</span> <span class="n">h'</span> 
       <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.insert</span><span class="o">]</span>
       <span class="n">cases</span> <span class="n">h'</span> <span class="k">with</span> 
       <span class="bp">|</span> <span class="n">node</span> <span class="n">l'</span> <span class="n">l'</span> <span class="n">nl</span> <span class="n">nr</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span> <span class="bp">=&gt;</span> <span class="o">{</span>
          <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Nat.blt</span> <span class="n">l.max</span> <span class="n">n'</span> <span class="bp">=</span> <span class="n">x</span>
          <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span>
          <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="n">simp</span>
                    <span class="n">constructor</span>
                    <span class="n">assumption</span>
                    <span class="n">apply</span> <span class="n">hr</span>
                    <span class="n">assumption</span>
                    <span class="n">assumption</span>
                    <span class="n">apply</span> <span class="n">ntree_min_helper</span>
                    <span class="n">assumption</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">ntree_max_helper</span> <span class="n">_</span> <span class="n">_</span> <span class="n">h3</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span>
                    <span class="n">apply</span> <span class="n">min_helper</span>
                    <span class="n">assumption</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.blt_eq</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span>
                    <span class="n">apply</span> <span class="n">Nat.le_of_lt</span>
                    <span class="n">assumption</span>
          <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">simp</span>
                     <span class="n">constructor</span>
                     <span class="n">apply</span> <span class="n">hl</span>
                     <span class="n">assumption</span>
                     <span class="n">assumption</span>
                     <span class="k">have</span> <span class="n">h6</span> <span class="o">:</span> <span class="n">ntree.max</span> <span class="o">(</span><span class="n">ntree.insert</span> <span class="n">l</span> <span class="n">n'</span><span class="o">)</span> <span class="bp">=</span> <span class="n">n'</span> <span class="o">:=</span> 
                       <span class="kd">by</span> <span class="n">apply</span> <span class="n">ntree_insert_max_helper</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
                     <span class="n">apply</span> <span class="n">ntree_max_helper'</span>
                     <span class="n">assumption</span>
                     <span class="n">assumption</span>
                     <span class="k">have</span> <span class="n">h7</span> <span class="o">:</span> <span class="n">n'</span> <span class="bp">&lt;=</span> <span class="n">ntree.max</span> <span class="n">l</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply</span> <span class="n">nat_blt_neq</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">ntree_max_helper</span> <span class="n">_</span> <span class="n">_</span> <span class="n">h3</span><span class="o">]</span> <span class="n">at</span> <span class="n">h7</span>
                     <span class="n">apply</span> <span class="n">Nat.le_trans</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
       <span class="o">}</span>
         

<span class="kd">theorem</span> <span class="n">ntree_ordered_insert_linarith</span> <span class="o">:</span> 
  <span class="k">forall</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">ntree</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">),</span> 
  <span class="n">ntree_ordered</span> <span class="n">t</span> <span class="bp">-&gt;</span> <span class="n">ntree_ordered</span> <span class="o">(</span><span class="n">t.insert</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">intro</span> <span class="n">t</span>
     <span class="n">induction</span> <span class="n">t</span>
     <span class="n">case</span> <span class="n">leaf</span> <span class="n">n</span> <span class="bp">=&gt;</span> 
       <span class="n">intro</span> <span class="n">n'</span> <span class="n">_</span>
       <span class="n">simp</span> <span class="o">[</span><span class="n">ntree.insert</span><span class="o">]</span>
       <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="bp">&lt;</span> <span class="n">n'</span> <span class="o">:</span> <span class="n">Bool</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span>
       <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span>
       <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> 
          <span class="c1">-- none of this is _interesting_...</span>
          <span class="n">rw</span> <span class="o">[</span><span class="n">if_pos</span><span class="o">]</span> <span class="bp">&lt;;&gt;</span> <span class="n">repeat</span> <span class="n">try</span> <span class="n">constructor</span>
          <span class="n">apply</span> <span class="n">Nat.le_of_lt</span>
          <span class="n">exact</span> <span class="o">(</span><span class="n">of_decide_eq_true</span> <span class="n">h</span><span class="o">)</span>
          <span class="n">exact</span> <span class="o">(</span><span class="n">of_decide_eq_true</span> <span class="n">h</span><span class="o">)</span>
       <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> 
          <span class="c1">-- again, not interesting!</span>
          <span class="n">rw</span> <span class="o">[</span><span class="n">if_neg</span><span class="o">]</span> <span class="bp">&lt;;&gt;</span> <span class="n">repeat</span> <span class="n">try</span> <span class="n">constructor</span>
          <span class="n">apply</span> <span class="n">Nat.ge_of_not_lt</span>
          <span class="n">exact</span> <span class="o">(</span><span class="n">of_decide_eq_false</span> <span class="n">h</span><span class="o">)</span>
          <span class="n">exact</span> <span class="o">(</span><span class="n">of_decide_eq_false</span> <span class="n">h</span><span class="o">)</span>
     <span class="n">case</span> <span class="n">node</span> <span class="n">l</span> <span class="n">r</span> <span class="n">hl</span> <span class="n">hr</span> <span class="bp">=&gt;</span>
       <span class="n">intro</span> <span class="n">n'</span> <span class="n">h'</span> 
       <span class="n">dsimp</span> <span class="o">[</span><span class="n">ntree.insert</span><span class="o">]</span>
       <span class="n">cases</span> <span class="n">h'</span> <span class="k">with</span> 
       <span class="bp">|</span> <span class="n">node</span> <span class="n">l'</span> <span class="n">l'</span> <span class="n">nl</span> <span class="n">nr</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span> <span class="bp">=&gt;</span> <span class="o">{</span>
          <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Nat.blt</span> <span class="n">l.max</span> <span class="n">n'</span> <span class="bp">=</span> <span class="n">x</span>
          <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span>
          <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="n">simp</span>
                    <span class="n">constructor</span>
                    <span class="n">assumption</span>
                    <span class="n">apply</span> <span class="n">hr</span>
                    <span class="n">assumption</span>
                    <span class="n">assumption</span>
                    <span class="n">apply</span> <span class="n">ntree_min_helper</span>
                    <span class="n">assumption</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">ntree_max_helper</span> <span class="n">_</span> <span class="n">_</span> <span class="n">h3</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span>
                    <span class="n">apply</span> <span class="n">min_helper</span>
                    <span class="n">assumption</span>
                    <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.blt_eq</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span>
                    <span class="n">apply</span> <span class="n">Nat.le_of_lt</span>
                    <span class="n">assumption</span>
          <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">simp</span>
                     <span class="n">constructor</span>
                     <span class="n">apply</span> <span class="n">hl</span>
                     <span class="n">assumption</span>
                     <span class="n">assumption</span>
                     <span class="k">have</span> <span class="n">h6</span> <span class="o">:</span> <span class="n">ntree.max</span> <span class="o">(</span><span class="n">ntree.insert</span> <span class="n">l</span> <span class="n">n'</span><span class="o">)</span> <span class="bp">=</span> <span class="n">n'</span> <span class="o">:=</span> 
                       <span class="kd">by</span> <span class="n">apply</span> <span class="n">ntree_insert_max_helper</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
                     <span class="n">apply</span> <span class="n">ntree_max_helper'</span>
                     <span class="n">assumption</span>
                     <span class="n">assumption</span>
                     <span class="k">have</span> <span class="n">h7</span> <span class="o">:</span> <span class="n">n'</span> <span class="bp">&lt;=</span> <span class="n">ntree.max</span> <span class="n">l</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply</span> <span class="n">nat_blt_neq</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
                     <span class="n">rw</span> <span class="o">[</span><span class="n">ntree_max_helper</span> <span class="n">_</span> <span class="n">_</span> <span class="n">h3</span><span class="o">]</span> <span class="n">at</span> <span class="n">h7</span>
                     <span class="n">apply</span> <span class="n">Nat.le_trans</span> <span class="bp">&lt;;&gt;</span> <span class="n">assumption</span>
       <span class="o">}</span>
</pre>
   </div>
  </div>
  <div class="navsetbottom">
   <span class="navleft">
   <div class="nosearchform"></div>
   &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
  </span>
  <span class="navright">&nbsp;&nbsp;<a href="l22.html" title="backward to &quot;Lecture 22: Generalizing hypotheses&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l35.html" title="forward to &quot;Lecture 35: Exam 2, Part A&quot;" data-pltdoc="x">next →</a></span>&nbsp;
 </div>
</div>
</div>
<div id="contextindicator">
&nbsp;
</div>
</body>
</html>
