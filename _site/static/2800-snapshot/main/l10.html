<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <title>
   dbp.io
  </title>
  <link rel="stylesheet" type="text/css" href="scribble.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted.css" title="default">
  <link rel="stylesheet" type="text/css" href="racket.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="manual-racket.css" title="default">
  <link rel="stylesheet" type="text/css" href="minted-default-style.css" title="default">
  <link rel="stylesheet" type="text/css" href="main.css" title="default">
  <script type="text/javascript" src="scribble-common.js"></script>
  <script type="text/javascript">
   (function() {
  document.write('<link rel="stylesheet" href="katex/katex.min.css" />');
})();(function() {document.write('<scr' + 'ipt type="text/javascript" src="katex/katex.min.js"></scr' + 'ipt>');})();(function(f) {
  // A "simple" onLoad function
  if (window.document.readyState == "complete") {
    f();
  } else if (window.document.addEventListener) {
    window.document.addEventListener("DOMContentLoaded", f, false);
  } else if (window.attachEvent) {
    window.attachEvent("onreadystatechange", function() {
      if (window.document.readyState == "complete") {
        f();
      }
    });
  } else {
    var oldLoad = window.onload;
    if (typeof(oldLoad) == "function") {
      window.onload = function() {
        try {
          oldLoad();
        } finally {
          f();
        }
      };
    } else {
      window.onload = f;
    }
  }
})(function() {
  // This is an ugly way to change the doctype, in case the scribble document
  // did not use (with-html5).
  if (!(document.doctype && document.doctype.publicId == '')) {
    if (console && console.log) {
      console.log("Re-wrote the document to use the HTML5 doctype.\n"
                  + "  Consider using the following declaration:\n"
                  + "      @title[#:style (with-html5 manual-doc-style)]{…}");
    }
    var wholeDoc = '<!doctype HTML>\n' + document.documentElement.outerHTML;
    document.open();
    document.clear();
    document.write(wholeDoc);
  }
  var inlineElements = document.getElementsByClassName("texMathInline");
  for (var i = 0; i < inlineElements.length; i++) {
    var e = inlineElements[i];
    katex.render(e.textContent, e, { displayMode:false, throwOnError:false });
  }
  var displayElements = document.getElementsByClassName("texMathDisplay");
  for (var i = 0; i < displayElements.length; i++) {
    var e = displayElements[i];
    katex.render(e.textContent, e, { displayMode:true, throwOnError:false });
  }
});
  </script>
  <script type="text/javascript" src="manual-racket.js"></script>
 </head>
 <body id="scribble-racket-lang-org">
  <div class="tocset">
   <div class="tocview">
    <div class="tocviewlist tocviewlisttopspace">
     <div class="tocviewtitle">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td style="width: 1em;">
          <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">►</a>
         </td>
         <td></td>
         <td>
          <a href="index.html" class="tocviewlink" data-pltdoc="x">Logic &amp; Computation</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <div class="tocviewsublisttop" style="display: none;" id="tocview_0">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="lectures.html" class="tocviewselflink" data-pltdoc="x">Lectures</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="homework.html" class="tocviewlink" data-pltdoc="x">Homework</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">▼</a>
        </td>
        <td></td>
        <td>
         <a href="lectures.html" class="tocviewlink" data-pltdoc="x">Lectures</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublist" style="display: block;" id="tocview_1">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l1.html" class="tocviewlink" data-pltdoc="x">Lecture 1:<span class="mywbr"> &nbsp;</span> Intro</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l2.html" class="tocviewlink" data-pltdoc="x">Lecture 2:<span class="mywbr"> &nbsp;</span> Logistics, Specifications in ISL</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l3.html" class="tocviewlink" data-pltdoc="x">Lecture 3:<span class="mywbr"> &nbsp;</span> Propositional Logic in Code</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l4.html" class="tocviewlink" data-pltdoc="x">Lecture 4:<span class="mywbr"> &nbsp;</span> Design /<span class="mywbr"> &nbsp;</span> Specification Recipe</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l5.html" class="tocviewlink" data-pltdoc="x">Lecture 5:<span class="mywbr"> &nbsp;</span> Relational Specifications</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l6.html" class="tocviewlink" data-pltdoc="x">Lecture 6:<span class="mywbr"> &nbsp;</span> For-<wbr>all, Intro to PBT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l7.html" class="tocviewlink" data-pltdoc="x">Lecture 7:<span class="mywbr"> &nbsp;</span> ==&gt;, PBT filtering</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l8.html" class="tocviewlink" data-pltdoc="x">Lecture 8:<span class="mywbr"> &nbsp;</span> PBT generators</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l9.html" class="tocviewlink" data-pltdoc="x">Lecture 9:<span class="mywbr"> &nbsp;</span> SAT</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 10:<span class="mywbr"> &nbsp;</span> SMT &amp; Rosette</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l11.html" class="tocviewlink" data-pltdoc="x">Lecture 11:<span class="mywbr"> &nbsp;</span> Rosette &amp; Finitization</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l12.html" class="tocviewlink" data-pltdoc="x">Lecture 12:<span class="mywbr"> &nbsp;</span> Higher order logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l13.html" class="tocviewlink" data-pltdoc="x">Lecture 13:<span class="mywbr"> &nbsp;</span> Functions</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l14.html" class="tocviewlink" data-pltdoc="x">Lecture 14:<span class="mywbr"> &nbsp;</span> Propositional logic</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l15.html" class="tocviewlink" data-pltdoc="x">Lecture 15:<span class="mywbr"> &nbsp;</span> Propositional logic &amp; programming</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l16.html" class="tocviewlink" data-pltdoc="x">Lecture 16:<span class="mywbr"> &nbsp;</span> Exam 1, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l17.html" class="tocviewlink" data-pltdoc="x">Lecture 17:<span class="mywbr"> &nbsp;</span> Exam 1, Part B</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l18.html" class="tocviewlink" data-pltdoc="x">Lecture 18:<span class="mywbr"> &nbsp;</span> Proving with tactics</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l19.html" class="tocviewlink" data-pltdoc="x">Lecture 19:<span class="mywbr"> &nbsp;</span> Inductive types &amp; proofs</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l20.html" class="tocviewlink" data-pltdoc="x">Lecture 20:<span class="mywbr"> &nbsp;</span> Lists</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l21.html" class="tocviewlink" data-pltdoc="x">Lecture 21:<span class="mywbr"> &nbsp;</span> Proof Practice</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l22.html" class="tocviewlink" data-pltdoc="x">Lecture 22:<span class="mywbr"> &nbsp;</span> Generalizing hypotheses</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l23.html" class="tocviewlink" data-pltdoc="x">Lecture 23:<span class="mywbr"> &nbsp;</span> Trees</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l35.html" class="tocviewlink" data-pltdoc="x">Lecture 35:<span class="mywbr"> &nbsp;</span> Exam 2, Part A</a>
         </td>
        </tr>
        <tr>
         <td align="right"></td>
         <td>
          <a href="l36.html" class="tocviewlink" data-pltdoc="x">Lecture 36:<span class="mywbr"> &nbsp;</span> Exam 2, Part B</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="tocviewlist">
     <table cellspacing="0" cellpadding="0">
      <tbody>
       <tr>
        <td style="width: 1em;">
         <a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">►</a>
        </td>
        <td></td>
        <td>
         <a href="" class="tocviewselflink" data-pltdoc="x">Lecture 10:<span class="mywbr"> &nbsp;</span> SMT &amp; Rosette</a>
        </td>
       </tr>
      </tbody>
     </table>
     <div class="tocviewsublistbottom" style="display: none;" id="tocview_2">
      <table cellspacing="0" cellpadding="0">
       <tbody>
        <tr>
         <td align="right">
          1&nbsp;
         </td>
         <td>
          <a href="#%28part._.Purpose%29" class="tocviewlink" data-pltdoc="x">Purpose</a>
         </td>
        </tr>
        <tr>
         <td align="right">
          2&nbsp;
         </td>
         <td>
          <a href="#%28part._.Outline%29" class="tocviewlink" data-pltdoc="x">Outline</a>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div>
   <div class="tocsub">
    <div class="tocsubtitle">
     On this page:
    </div>
    <table class="tocsublist" cellspacing="0">
     <tbody>
      <tr>
       <td>
        <span class="tocsublinknumber">1
        <tt>
         &nbsp;
        </tt>
       </span>
       <a href="#%28part._.Purpose%29" class="tocsubseclink" data-pltdoc="x">Purpose</a>
      </td>
     </tr>
     <tr>
      <td>
       <span class="tocsublinknumber">2
       <tt>
        &nbsp;
       </tt>
      </span>
      <a href="#%28part._.Outline%29" class="tocsubseclink" data-pltdoc="x">Outline</a>
     </td>
    </tr>
   </tbody>
  </table>
 </div>
</div>
<div class="maincolumn">
 <div class="main">
  <div class="versionbox">
   <span class="version">8.7</span>
  </div>
  <div class="navsettop">
   <span class="navleft">
   <div class="nosearchform"></div>
   &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
  </span>
  <span class="navright">&nbsp;&nbsp;<a href="l9.html" title="backward to &quot;Lecture 9: SAT&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l11.html" title="forward to &quot;Lecture 11: Rosette &amp; Finitization&quot;" data-pltdoc="x">next →</a></span>&nbsp;
 </div>
 <h4>
  <a name="(part._l10)"></a>Lecture 10: SMT &amp; Rosette
 </h4>
 <h5>
  1
  <tt>
   &nbsp;
  </tt>
  <a name="(part._.Purpose)"></a>Purpose
 </h5>
 <p>
  Introduce SMT as generalization of SAT, Rosette as tool that does translation automatically. Show simple validations.
 </p>
 <h5>
  2
  <tt>
   &nbsp;
  </tt>
  <a name="(part._.Outline)"></a>Outline
 </h5>
 <p></p>
 <div class="SIntrapara">
  <span class="Larger">Install Rosette</span>
Still in DrRacket,
 </div>
 <div class="SIntrapara">
  <table cellspacing="0" cellpadding="0" class="SVerbatim">
   <tbody>
    <tr>
     <td>
      <p>
       <span class="stt">File -&gt; Install Package</span>
      </p>
     </td>
    </tr>
   </tbody>
  </table>
 </div>
 <div class="SIntrapara">
  , type "rosette", click "Install", and wait a bit until the "Install"
button turns into "Update".
 </div>
 <p></p>
 <p>
  All files should now start with <span class="default"><code class="highlight-inline"><span class="kn">#lang </span><span class="nn">rosette/safe</span><span class="w"></span></code></span>.
 </p>
 <p>
  <span class="Larger">SAT &amp; SMT</span>
 </p>
 <p>
  Last time, we saw how SAT can be used to reason about programs. In particular, how we can encode
programs, or at least finite approximations of programs, as SAT formulas, and then use SAT solvers to
try to find examples that violate assertions in the programs. This idea, Bounded Model Checking, is
quite important, but one limitation to doing it with SAT solvers is that you have to encode everything
in terms of booleans, which can lead to massive formula explosion.
 </p>
 <p>
  SMT solvers are a generalization of SAT solvers that can additionally reason about other data types:
integers, bit vectors, etc. This doesn’t make the encoding challenge go away, as you still have to
translate the program into a formula, but the language that the formulas can include is much richer,
and thus the formulas can be much smaller.
 </p>
 <p>
  In this class, we aren’t actually going to directly use either a SAT solver or an SMT solver: the
encoding challenge is large enough that it would take too much time. Instead, we are going to use a
state-of-the-art tool called Rosette, that packages up SMT and additionally does some amount of concrete
evaluation, so you can write programs that involve "symbolic variables" that can be solved for, but also
write normal functional code that will operate as expected.
 </p>
 <p>
  <span class="Larger">Example</span>
If we think back to examples from property based testing, we can see how this can be useful.
 </p>
 <p>
  Sometimes it’s not obvious what the important inputs are. For example, what if we defined a (pathological)
multiplication function as:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="n">quickcheck</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">bad-mult</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">10417</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  Then we could certainly test it with quickcheck:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">bad-mult-prop</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="n">bad-mult</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="n">quickcheck</span><span class="w"> </span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="p">[(</span><span class="n">x</span><span class="w"> </span><span class="n">arbitrary-integer</span><span class="p">)</span><span class="w"></span>
<span class="w">                       </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="n">arbitrary-integer</span><span class="p">)]</span><span class="w"></span>
<span class="w">                      </span><span class="p">(</span><span class="n">bad-mult-prop</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  Note that here we are using the same quickcheck library that ISL-Spec wraps up, but here using it
directly. First we import it with <span class="RktPn">(</span><span class="RktSym">require</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">quickcheck</span><span class="RktPn">)</span><span class="RktMeta"></span>. The invocation <span class="RktSym">quickcheck</span><span class="RktMeta"></span>
corresponds to <span class="RktSym">check-property</span><span class="RktMeta"></span>, and <span class="RktSym">property</span><span class="RktMeta"></span> corresponds to <span class="RktSym">for-all</span><span class="RktMeta"></span>.
 </p>
 <p>
  While we can run this,more than likely, these test will pass: indeed, on all inputs except x = 10417, the property is true.
When we select randomly, the chance that we find this pathological input is quite small. Indeed, this is a
general problem: uncommon bugs may be hard to find with PBT. There can even be "common" bugs (i.e., ones that
happen a lot), but if the distribution
of random inputs don’t happen to hit that input – e.g., I can change the pathological function to:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">bad-mult-2</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">10417</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  And even though there are now tons of bad inputs, our random integers are not uniformly distributed: they are
much more frequently small numbers, and as a result, it’s still quite unlikely that this is caught by our
testing. We could fix this by coming up with a different distribution for testing, but there’s an issue: now you
need to know where the bad inputs are. If you knew that, you might not have had the bug!
 </p>
 <p>
  There is an alternative: exhaustively testing all inputs. Now, naively doing this would we way too slow.
But if remember the bounded model checking idea, if this program could be translated to SAT such that a
counterexample corresponds to a satisfying assignment, we can do exhaustive testing in quite reasonable time. e.g.,
there are SAT solvers that can solve formulas with a half million variables! Naively doing that would take an astronomical
amount of time (actually, much longer than astronomical! Our language fails to capture the magnitude of <span class="texMathInline">2^{5000000}</span>)
 </p>
 <p>
  Now, as it turns out, directly encoding things in terms of SAT can be really hard, and lead to massive explosions, so
people have been working on developing solvers that can also handle, for example, integers, bit vectors, strings, etc.
These so-called SMT (SAT Modulo Theory) solvers underly lots of modern automated tools.
 </p>
 <p>
  Rosette allows us to do that by defining symbolic variables of a handful of types
and then writing assertions. It will then translate portions of your code into SMT and use a solver to see if there is
a way to violate the assertion.
 </p>
 <p>
  In this case, we can define symbolic variables for integers, and then get Rosette to find a falsifying assignment
for our <span class="RktSym">bad-mult-prop</span><span class="RktMeta"></span>:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="n">define-symbolic</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="nb">integer?</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="n">bad-mult-prop</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span><span class="w"></span>
</pre>
  </div>
 </div>
 <p>
  Rosette has several different purposes, but the only one we will use is <span class="RktSym">verify</span><span class="RktMeta"></span>, which takes some
expression (which should involve symbolic values) that contains <span class="RktSym">assert</span><span class="RktMeta"></span>ions, and looks for an
assignment to those values that causes it to be false. If it finds one, it will say that it found a
<span class="RktSym">model</span><span class="RktMeta"></span>, and you can print that model out, or use it in various ways. Thus, it gives a concrete counter-example. If it can prove that there is no such assignment, it will report <span class="RktSym">unsat</span><span class="RktMeta"></span>.
 </p>
 <p>
  <span class="Larger">Troubleshooting with Rosette</span>
 </p>
 <p>
  We use Quickcheck before running Rosette because Rosette will treat any error it finds as a counterexample, which means that if our code always fails (e.g., it has a typo), Rosette will report <span class="RktPn">(</span><span class="RktSym">model</span><span class="RktPn">)</span><span class="RktMeta"></span>, which means it found a counterexample, but without needing to put any constraints on the symbolic values (hence the model being empty). If you instead first run the code on concrete values (either with Quickcheck, or just by hand), you’ll find those bugs, get stacktraces, and can fix before you go to Rosette.
 </p>
 <p>
  Second: always put <span class="RktSym">assert</span><span class="RktMeta"></span> <span style="font-style: italic">inside</span> the call to <span class="RktSym">verify</span><span class="RktMeta"></span>. If you put it outside, it will change the meaning of the query: the assertion will
instead we ensured to be true, rather than being used to search for a counter
example. What that means is that an otherwise reasonable refactoring to your
code (to pull out the expression <span class="RktSym">assert</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">...</span><span class="RktMeta"></span> as a named variable) will
result in <span class="RktPn">(</span><span class="RktSym">unsat</span><span class="RktPn">)</span><span class="RktMeta"></span> for no reason.
 </p>
 <p>
  <span class="Larger">Creating your own symbolic values</span>
 </p>
 <p>
  While Rosette has a few built-in types, you can also define your own symbolic values. For example,
we can define a symbolic Color as the following:
 </p>
 <div class="default">
  <div class="highlight">
   <pre><span></span><span class="p">(</span><span class="k">define-struct</span><span class="w"> </span><span class="n">gray</span><span class="w"> </span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="w"> </span><span class="kd">#:transparent</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">choose-color</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">generator-bind</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="n">choose-integer</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="k">λ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="p">(</span><span class="n">choose-one-of</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="s2">"red"</span><span class="w"></span>
<span class="w">                          </span><span class="s2">"green"</span><span class="w"></span>
<span class="w">                          </span><span class="s2">"blue"</span><span class="w"></span>
<span class="w">                          </span><span class="p">(</span><span class="n">make-gray</span><span class="w"> </span><span class="n">n</span><span class="p">))))))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">not-gray?</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="n">gray?</span><span class="w"> </span><span class="n">c</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="n">quickcheck</span><span class="w"> </span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="p">[(</span><span class="n">c</span><span class="w"> </span><span class="n">choose-color</span><span class="p">)]</span><span class="w"></span>
<span class="w">                      </span><span class="p">(</span><span class="n">not-gray?</span><span class="w"> </span><span class="n">c</span><span class="p">)))</span><span class="w"></span>


<span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="n">rosette/lib/synthax</span><span class="p">)</span><span class="w"> </span><span class="c1">;; for ??</span><span class="w"></span>
<span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="n">rosette/lib/angelic</span><span class="p">)</span><span class="w"> </span><span class="c1">;; for choose*</span><span class="w"></span>

<span class="p">(</span><span class="k">define-struct</span><span class="w"> </span><span class="n">rgb</span><span class="w"> </span><span class="p">[</span><span class="n">R</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="n">B</span><span class="p">]</span><span class="w"> </span><span class="kd">#:transparent</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">symbolic-color</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">choose*</span><span class="w"> </span><span class="o">'</span><span class="ss">red</span><span class="w"> </span><span class="o">'</span><span class="ss">green</span><span class="w"> </span>
<span class="w">                                  </span><span class="o">'</span><span class="ss">blue</span><span class="w"> </span>
<span class="w">                                  </span><span class="p">(</span><span class="n">make-rgb</span><span class="w"> </span><span class="p">(</span><span class="n">??</span><span class="w"> </span><span class="nb">integer?</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">??</span><span class="w"> </span><span class="nb">integer?</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">??</span><span class="w"> </span><span class="nb">integer?</span><span class="p">))))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">is-named-color?</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">'</span><span class="ss">red</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">'</span><span class="ss">green</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">'</span><span class="ss">blue</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="n">symbolic-color</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="p">(</span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="n">is-named-color?</span><span class="w"> </span><span class="n">c</span><span class="p">))))</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="p">(</span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="n">is-named-color?</span><span class="w"> </span><span class="n">c</span><span class="p">)))))</span><span class="w"></span>
<span class="p">(</span><span class="n">evaluate</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">m1</span><span class="p">)</span><span class="w"> </span><span class="c1">; (rgb ??:10:44:45 ??:10:44:59 ??:10:44:73)</span><span class="w"></span>
<span class="p">(</span><span class="n">evaluate</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">m2</span><span class="p">)</span><span class="w"> </span><span class="c1">; 'green</span><span class="w"></span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">symbolic-rgb</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">make-rgb</span><span class="w"> </span><span class="p">(</span><span class="n">??</span><span class="w"> </span><span class="nb">integer?</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">??</span><span class="w"> </span><span class="nb">integer?</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">??</span><span class="w"> </span><span class="nb">integer?</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">red-positive?</span><span class="w"> </span><span class="n">rgb</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">rgb-R</span><span class="w"> </span><span class="n">rgb</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="p">(</span><span class="n">symbolic-rgb</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="p">(</span><span class="n">verify</span><span class="w"> </span><span class="p">(</span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="n">red-positive?</span><span class="w"> </span><span class="n">c2</span><span class="p">))))</span><span class="w"></span>
<span class="p">(</span><span class="n">evaluate</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="n">m3</span><span class="p">)</span><span class="w"> </span><span class="c1">; (rgb 0 ??:10:57:48 ??:10:57:62)</span><span class="w"></span>
</pre>
  </div>
 </div>
 <div class="navsetbottom">
  <span class="navleft">
  <div class="nosearchform"></div>
  &nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span>
 </span>
 <span class="navright">&nbsp;&nbsp;<a href="l9.html" title="backward to &quot;Lecture 9: SAT&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="lectures.html" title="up to &quot;Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="l11.html" title="forward to &quot;Lecture 11: Rosette &amp; Finitization&quot;" data-pltdoc="x">next →</a></span>&nbsp;
</div>
</div>
</div>
<div id="contextindicator">
&nbsp;
</div>
</body>
</html>
